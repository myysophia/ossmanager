(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4354],{7161:(e,r,t)=>{"use strict";t.d(r,{HY:()=>o,Hl:()=>s});let s=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},o=e=>{var r;return e&&"object"==typeof e&&"response"in e&&(null===(r=e.response)||void 0===r?void 0:r.status)===401}},22954:(e,r,t)=>{Promise.resolve().then(t.bind(t,59654))},59654:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>X});var s=t(95155),o=t(12115),n=t(41046),l=t(23006),i=t(22900),a=t(75569),c=t(11649),d=t(79788),u=t(21688),g=t(58670),h=t(77700),p=t(26418),m=t(79175),x=t(4316),f=t(33636),j=t(53270),S=t(58727),b=t(86697),y=t(39376),E=t(77978),z=t(10351),w=t(96918);class v{static async getUserBucketAccess(){try{var e;let r=await w.A.get("/user/current");if(!(null===(e=r.data)||void 0===e?void 0:e.id))throw Error("获取当前用户信息失败");let t=r.data.id,s=await w.A.get("/users/".concat(t,"/bucket-access"));if(200===s.code)return s.data;throw Error(s.data.message||"获取 bucket 访问权限失败")}catch(e){throw console.error("获取 bucket 访问权限失败:",e),e}}}var k=t(25442),B=t(64688),C=t(61549),T=t(27104),I=t(3740),_=t(19782),F=t(5643),M=t(80436),P=t(43508),R=t(49174);let L=e=>{if(0===e)return"0 B";let r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(2))+" "+["B","KB","MB","GB"][r]},D=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),A=e=>{let{isOpen:r,onClose:t,onConfirm:o,newFile:n,existingFile:l}=e;return(0,s.jsxs)(k.aF,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[(0,s.jsx)(B.m,{bg:"blackAlpha.600",backdropFilter:"blur(4px)"}),(0,s.jsxs)(C.$,{children:[(0,s.jsx)(T.r,{children:(0,s.jsxs)(S.z,{spacing:3,children:[(0,s.jsx)(I.I,{as:z.eHT,color:"orange.500",boxSize:6}),(0,s.jsx)(g.E,{children:"文件已存在"})]})}),(0,s.jsx)(_.s,{}),(0,s.jsx)(F.c,{children:(0,s.jsxs)(a.T,{spacing:4,align:"stretch",children:[(0,s.jsxs)(d.F,{status:"warning",borderRadius:"md",children:[(0,s.jsx)(u._,{}),(0,s.jsxs)(a.T,{align:"start",spacing:1,children:[(0,s.jsx)(g.E,{fontWeight:"medium",children:"发现同名文件"}),(0,s.jsx)(g.E,{fontSize:"sm",children:"继续上传将覆盖原文件，此操作不可撤销。"})]})]}),l&&(0,s.jsxs)(h.a,{children:[(0,s.jsx)(g.E,{fontSize:"lg",fontWeight:"bold",mb:4,color:"gray.700",children:"即将被覆盖的文件"}),(0,s.jsxs)(h.a,{w:"full",p:4,bg:"red.50",borderRadius:"md",borderLeft:"4px solid",borderLeftColor:"red.400",children:[(0,s.jsxs)(S.z,{justify:"space-between",mb:2,children:[(0,s.jsxs)(S.z,{children:[(0,s.jsx)(I.I,{as:z.QuH,color:"red.500"}),(0,s.jsx)(g.E,{fontWeight:"semibold",color:"red.700",children:"原文件（将被覆盖）"})]}),(0,s.jsx)(M.E,{colorScheme:"red",variant:"subtle",children:"已存在"})]}),(0,s.jsxs)(a.T,{align:"start",spacing:2,fontSize:"sm",children:[(0,s.jsxs)(S.z,{children:[(0,s.jsx)(I.I,{as:z.QuH,boxSize:4,color:"gray.500"}),(0,s.jsx)(g.E,{color:"gray.600",children:"文件名："}),(0,s.jsx)(g.E,{fontWeight:"medium",wordBreak:"break-all",children:l.original_filename})]}),(0,s.jsxs)(S.z,{children:[(0,s.jsx)(I.I,{as:z.nOB,boxSize:4,color:"gray.500"}),(0,s.jsx)(g.E,{color:"gray.600",children:"大小："}),(0,s.jsx)(g.E,{fontWeight:"medium",children:L(l.file_size)})]}),(0,s.jsxs)(S.z,{children:[(0,s.jsx)(I.I,{as:z.Ohp,boxSize:4,color:"gray.500"}),(0,s.jsx)(g.E,{color:"gray.600",children:"上传时间："}),(0,s.jsx)(g.E,{fontWeight:"medium",children:D(l.created_at)})]}),l.path&&(0,s.jsxs)(S.z,{children:[(0,s.jsx)(I.I,{as:z.QuH,boxSize:4,color:"gray.500"}),(0,s.jsx)(g.E,{color:"gray.600",children:"存储路径："}),(0,s.jsxs)(g.E,{fontWeight:"medium",fontSize:"xs",fontFamily:"monospace",bg:"gray.100",px:2,py:1,borderRadius:"md",children:["/",l.path,"/"]})]})]})]})]}),(0,s.jsx)(P.c,{}),(0,s.jsxs)(h.a,{children:[(0,s.jsx)(g.E,{fontSize:"md",fontWeight:"medium",color:"gray.700",mb:2,children:"是否继续上传并覆盖原文件？"}),(0,s.jsxs)(g.E,{fontSize:"sm",color:"gray.600",children:["请仔细确认，覆盖操作无法撤销。",(null==l?void 0:l.path)?'新文件将覆盖位于 "'.concat(l.path,'" 路径下的同名文件。'):"新文件将覆盖根目录下的同名文件。","如果您不确定，建议取消上传并重命名文件或选择不同的存储路径。"]})]})]})}),(0,s.jsx)(R.j,{children:(0,s.jsxs)(S.z,{spacing:3,children:[(0,s.jsx)(E.$,{variant:"ghost",onClick:()=>{t()},size:"lg",children:"取消上传"}),(0,s.jsx)(E.$,{colorScheme:"red",onClick:()=>{o()},size:"lg",leftIcon:(0,s.jsx)(z.eHT,{}),children:"确认覆盖"})]})})]})]})};var N=t(49509);let U={maxFileSize:0x140000000,maxFileCount:20};function O(e){if(0===e)return"0 B";let r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(2))+" "+["B","KB","MB","GB"][r]}function W(e){if(0===e)return"0 B/s";let r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(2))+" "+["B/s","KB/s","MB/s","GB/s"][r]}function H(e){return 0!==e&&isFinite(e)?e<60?"".concat(Math.ceil(e),"秒"):e<3600?"".concat(Math.ceil(e/60),"分钟"):"".concat(Math.ceil(e/3600),"小时"):"--"}function X(){let[e,r]=(0,o.useState)([]),[t,k]=(0,o.useState)(!1),[B,C]=(0,o.useState)(""),[T,I]=(0,o.useState)([]),[_,F]=(0,o.useState)([]),[M,P]=(0,o.useState)(null),[R,L]=(0,o.useState)(!0),[D,X]=(0,o.useState)(""),[G,q]=(0,o.useState)(!1),[J,K]=(0,o.useState)(null),[$,Q]=(0,o.useState)(null),[Z,V]=(0,o.useState)(null),Y=(0,l.d)();(0,o.useEffect)(()=>{(async()=>{try{let e=await v.getUserBucketAccess();F(e),e.length>0&&P(e[0].id)}catch(e){Y({title:"获取 bucket 列表失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}finally{L(!1)}})()},[Y]);let ee=(0,o.useCallback)((e,t)=>{let s=[...e,...t.map(e=>e.file)];if(s.length>0){let e=s.map(e=>({id:Math.random().toString(36).substring(2,9),file:e,progress:0,status:"ready",frontendProgress:0,backendProgress:0,progressSource:"frontend"}));r(r=>[...r,...e])}},[]),{getRootProps:er,getInputProps:et,isDragActive:es}=(0,n.VB)({onDrop:ee}),eo=t=>{let s=e.find(e=>e.id===t);s&&window.confirm('确定要从上传列表中移除文件 "'.concat(s.file.name,'" 吗？'))&&r(e.filter(e=>e.id!==t))},en=async e=>{console.log("开始初始化上传任务，文件大小:",e);try{let r=await w.A.post("/uploads/init",{total:e});console.log("初始化上传任务响应:",r);let t=r;if("data"in r&&r.data&&(t=r.data),!t||"object"!=typeof t)throw console.error("响应格式错误:",t),Error("服务器返回数据格式错误");if("code"in t&&200!==t.code&&0!==t.code)throw Error("初始化上传任务失败: ".concat(t.message||"未知错误"));let s=t.data||t;if(!s||!s.id)throw console.error("响应中缺少task_id:",t),Error("服务器返回的数据中缺少task_id");return console.log("获取到task_id:",s.id),s.id}catch(t){if(console.error("初始化上传任务失败，完整错误对象:",t),console.error("错误类型:",typeof t),console.error("错误名称:",t.name),console.error("错误消息:",t.message),console.error("错误栈:",t.stack),t.response){var r;console.error("这是axios响应错误"),console.error("错误响应状态:",t.response.status),console.error("错误响应数据:",t.response.data),console.error("错误响应头:",t.response.headers);let e=(null===(r=t.response.data)||void 0===r?void 0:r.message)||t.response.statusText||"网络请求失败";throw Error("初始化上传任务失败: ".concat(t.response.status," - ").concat(e))}if(t.request)throw console.error("这是网络错误"),console.error("错误请求:",t.request),Error("网络连接失败，请检查网络");console.error("这是其他类型错误");let e=t.message||String(t)||"完全未知错误";throw Error("初始化上传任务失败: ".concat(e))}},el=(e,t,s)=>{localStorage.getItem("token");let o=N.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",n="".concat(o,"/uploads/").concat(e,"/stream");console.log("创建SSE连接:",n),console.log("直连后端，依赖cookie认证");let l=new EventSource(n),i=Date.now(),a=0,c=[],d=!1;return l.addEventListener("progress",e=>{try{let{total:s,uploaded:o}=JSON.parse(e.data);d||(d=!0);let n=Date.now(),l=(n-i)/1e3,u=o-a,g=0;l>=2&&u>0&&(g=u/l,c.push(g),c.length>5&&c.shift(),i=n,a=o);let h=c.length>0?c.reduce((e,r)=>e+r,0)/c.length:0,p=s>0?o/s*100:0,m=s-o,x=h>0&&m>0?m/h:0;console.log("后端进度更新:",{progress:p.toFixed(1),uploaded:o,total:s,avgSpeed:h}),r(e=>e.map(e=>{if(e.id===t){let r=e.progress||0;if(!(p>0)||!(p>=r))return{...e,backendProgress:p,uploadSpeed:h>0?h:e.uploadSpeed,estimatedTimeRemaining:x>0?x:e.estimatedTimeRemaining};{let r=e.uploadedBytes||0,t=Math.max(o,r);return{...e,progress:Math.min(p,99),backendProgress:p,uploadedBytes:t,uploadSpeed:h,estimatedTimeRemaining:x,progressSource:"backend"}}}return e}))}catch(e){console.error("解析进度数据失败:",e)}}),l.onmessage=e=>{try{let r=JSON.parse(e.data);console.log("解析默认消息数据:",r)}catch(r){console.log("默认消息不是JSON格式:",e.data)}},l.addEventListener("open",()=>{console.log("SSE连接已建立")}),l.onerror=e=>{console.error("SSE连接错误:",e),console.error("SSE readyState:",l.readyState),d||(console.log("SSE连接失败，回退到前端进度显示"),r(e=>e.map(e=>e.id===t?{...e,progressSource:"frontend"}:e))),l.readyState===EventSource.CLOSED?console.log("SSE连接已关闭"):l.readyState===EventSource.CONNECTING&&console.log("SSE正在重连...")},l},ei=async(e,t,s,o)=>{let n=!0;{let l=e.stream().getReader(),i=0,a=Date.now(),c=[],d={method:"POST",headers:s,body:new ReadableStream({async pull(t){let{done:s,value:n}=await l.read();if(s){t.close();return}t.enqueue(n),i+=n.length;let d=Date.now(),u=(d-a)/1e3;if(u>.5){let t=n.length/u;c.push(t),c.length>3&&c.shift(),a=d;let s=c.reduce((e,r)=>e+r,0)/c.length,l=i/e.size*100,g=e.size-i,h=s>0&&g>0?g/s:0;console.log("前端进度更新:",{progress:l.toFixed(1),uploaded:i,total:e.size,avgSpeed:s,fileId:o}),r(e=>e.map(e=>{if(e.id===o){let r=e.progress||0,t=Math.min(l,90);if(console.log("\uD83D\uDCCA 更新文件进度:",{fileId:e.id,currentProgressSource:e.progressSource,currentProgress:r,calculatedProgress:l.toFixed(1),finalProgress:Math.max(t,r).toFixed(1)}),"backend"!==e.progressSource){let o=Math.max(t,r);return o>=90?e:{...e,progress:o,frontendProgress:l,uploadedBytes:Math.max(i,e.uploadedBytes||0),uploadSpeed:s,estimatedTimeRemaining:h,progressSource:"frontend"}}}return e}))}}})};d.duplex="half",console.log("使用ReadableStream上传，预期文件大小:",e.size);try{let e=await fetch(t,d);if(!e.ok)throw Error("上传失败: ".concat(e.status));return e.json()}catch(e){console.warn("ReadableStream上传失败，尝试降级到File对象上传:",e),n=!1}}if(!n){console.log("使用File对象直接上传（降级方案），文件大小:",e.size);let r={...s};delete r["Content-Length"];let o=await fetch(t,{method:"POST",headers:r,body:e});if(!o.ok)throw Error("上传失败: ".concat(o.status));return o.json()}},ea=async(e,r)=>{try{let t={filename:e,region_code:r.region_code,bucket_name:r.bucket_name};return D.trim()&&(t.custom_path=D.trim()),(await w.A.get("/oss/files/check-duplicate",{params:t})).data}catch(e){return console.error("检查重复文件失败:",e),{exists:!1}}},ec=(e,r)=>new Promise(t=>{K(r),Q(e),V(()=>t),q(!0)}),ed=async()=>{q(!1),Z&&Z(!0),K(null),Q(null),V(null)},eu=async()=>{if(0===e.length){Y({title:"请先选择文件",status:"warning",duration:3e3,isClosable:!0});return}let t=_.find(e=>e.id===M);if(!t){Y({title:"请选择存储位置",status:"warning",duration:3e3,isClosable:!0});return}k(!0);let s=e.map(async e=>{if("ready"!==e.status)return;let s=null,o=null,n={exists:!1};try{let l=Date.now();if(r(r=>r.map(r=>r.id===e.id?{...r,progress:0,status:"initializing",startTime:l,uploadedBytes:0,uploadSpeed:0,estimatedTimeRemaining:0,frontendProgress:0,backendProgress:0,progressSource:"frontend"}:r)),(n=await ea(e.file.name,t)).exists&&!await ec(e,n)){r(r=>r.map(r=>r.id===e.id?{...r,status:"error",error:"用户取消上传"}:r));return}let i=await en(e.file.size);r(r=>r.map(r=>r.id===e.id?{...r,status:"uploading",taskId:i,progressSource:"frontend"}:r)),s=el(i,e.id,e.file.size),(()=>{var t;let s=0,n=Date.now(),l=e.file.size,i=(t=l/1048576)<60?6e3:t<100?1e4:t<300?3e4:t<500?5e4:t<1e3?8e4:Math.min(12e4,100*t),a=15/i*2e3,c=Math.max(1048576,Math.min(0xf00000,l/(i/1e3*6.67)));o=setInterval(()=>{let t=Date.now()-n;if((s+=a)>=15||t>=i){o&&(clearInterval(o),o=null);return}let d=Math.floor(s/100*l),u=(l-d)/c;r(r=>{let t=!1,n=r.map(r=>{if(r.id===e.id){if("backend"===r.progressSource)return t=!0,r;if("frontend"===r.progressSource&&r.progress<=s)return console.log("\uD83C\uDFAD 假进度更新:",{fakeProgress:s.toFixed(1),fileId:e.id,currentProgress:r.progress,uploadedBytes:O(d),speed:W(c),eta:H(u)}),{...r,progress:Math.min(s,15),frontendProgress:s,uploadedBytes:d,uploadSpeed:c,estimatedTimeRemaining:u,progressSource:"frontend"};"frontend"===r.progressSource&&r.progress>s&&(t=!0)}return r});return t&&o&&(clearInterval(o),o=null),n})},2e3),setTimeout(()=>{o&&(clearInterval(o),o=null)},i+1e4)})(),console.log("SSE连接创建完成，立即开始文件上传（并行执行）");let a=N.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",c="".concat(a,"/oss/files");console.log("流式上传URL:",c);let d=localStorage.getItem("token"),u=encodeURIComponent(e.file.name),g={"Content-Type":"application/octet-stream","Content-Length":e.file.size.toString(),"X-File-Name":u,region_code:t.region_code,bucket_name:t.bucket_name};D.trim()&&(g["X-Custom-Path"]=D.trim()),d&&(g.Authorization="Bearer ".concat(d)),i&&(g["Upload-Task-ID"]=i),n.exists&&(g["X-Force-Overwrite"]="true"),console.log("设置上传Headers:",{"Content-Length":g["Content-Length"],"X-File-Name":g["X-File-Name"],"Upload-Task-ID":g["Upload-Task-ID"]});let h=await ei(e.file,c,g,e.id);s&&s.close(),o&&(clearInterval(o),o=null),r(r=>r.map(r=>r.id===e.id?{...r,progress:100,status:"done",result:h,uploadedBytes:e.file.size,uploadSpeed:0,estimatedTimeRemaining:0}:r))}catch(t){s&&s.close(),o&&(clearInterval(o),o=null),r(r=>r.map(r=>r.id===e.id?{...r,progress:0,status:"error",error:t instanceof Error?t.message:"上传失败"}:r))}});await Promise.all(s),k(!1);let o=e.filter(e=>"error"===e.status).length,n=e.filter(e=>"done"===e.status).length;0===o&&n>0?Y({title:"上传完成",description:"成功上传 ".concat(n," 个文件"),status:"success",duration:3e3,isClosable:!0}):o>0&&n>0?Y({title:"上传部分完成",description:"成功上传 ".concat(n," 个文件，").concat(o," 个文件失败"),status:"warning",duration:3e3,isClosable:!0}):o>0&&0===n&&Y({title:"上传失败",description:"所有 ".concat(o," 个文件上传失败"),status:"error",duration:3e3,isClosable:!0})};return(0,s.jsxs)(i.m,{maxW:"container.xl",py:10,children:[(0,s.jsxs)(a.T,{spacing:8,align:"stretch",children:[(0,s.jsx)(c.D,{size:"lg",children:"文件上传"}),(0,s.jsxs)(d.F,{status:"info",children:[(0,s.jsx)(u._,{}),(0,s.jsxs)(a.T,{align:"start",spacing:1,children:[(0,s.jsx)(g.E,{fontWeight:"bold",children:"安全提示:"}),(0,s.jsxs)(g.E,{fontSize:"sm",children:["• 最大文件大小: ",(U.maxFileSize/1024/1024).toFixed(0),"MB"]}),(0,s.jsxs)(g.E,{fontSize:"sm",children:["• 最多文件数量: ",U.maxFileCount,"个"]}),(0,s.jsx)(g.E,{fontSize:"sm",children:"• 支持格式: 图片、PDF、Office文档、文本、压缩包"})]})]}),(0,s.jsxs)(h.a,{...er(),borderWidth:2,borderStyle:"dashed",borderRadius:"lg",borderColor:es?"blue.500":"gray.300",p:10,bg:es?"blue.50":"gray.50",textAlign:"center",cursor:"pointer",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"blue.50"},children:[(0,s.jsx)("input",{...et()}),es?(0,s.jsx)(g.E,{fontSize:"lg",color:"blue.500",children:"释放文件以上传..."}):(0,s.jsxs)(a.T,{spacing:2,children:[(0,s.jsx)(z.B88,{size:40,color:"gray"}),(0,s.jsx)(g.E,{fontSize:"lg",children:"拖放文件到此处，或点击选择文件"}),(0,s.jsx)(g.E,{color:"gray.500",fontSize:"sm",children:"支持的文件类型: 图片, PDF, Word, Excel, 文本文件, ZIP, RAR, TAR.GZ,Nova 文件格式后缀(如.calib)"}),(0,s.jsx)(g.E,{color:"red.500",fontSize:"xs",children:"禁止上传可执行文件和脚本文件"})]})]}),(0,s.jsxs)(p.MJ,{isRequired:!0,children:[(0,s.jsx)(m.l,{children:"存储位置"}),R?(0,s.jsx)(x.l,{placeholder:"加载中...",isDisabled:!0}):_.length>0?(0,s.jsx)(x.l,{value:null!=M?M:"",onChange:e=>P(Number(e.target.value)||null),placeholder:"选择存储位置",children:_.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.region_code," - ",e.bucket_name]},e.id))}):(0,s.jsxs)(d.F,{status:"warning",children:[(0,s.jsx)(u._,{}),(0,s.jsxs)(a.T,{align:"start",spacing:1,children:[(0,s.jsx)(g.E,{fontWeight:"medium",children:"暂无可用的存储位置"}),(0,s.jsx)(g.E,{fontSize:"sm",children:"请联系管理员配置存储bucket或为您分配访问权限"})]})]})]}),(0,s.jsxs)(p.MJ,{children:[(0,s.jsx)(m.l,{children:"存储路径 (可选)"}),(0,s.jsx)(f.p,{value:D,onChange:e=>X(e.target.value),placeholder:"自定义/文件夹/路径"}),(0,s.jsx)(g.E,{fontSize:"xs",color:"gray.500",mt:1,children:"留空则存储到根目录，支持多级目录如：文档/图片/2024"})]}),e.length>0&&(0,s.jsxs)(h.a,{children:[(0,s.jsxs)(c.D,{size:"md",mb:4,children:["已选择的文件 (",e.length,")"]}),(0,s.jsx)(j.B8,{spacing:3,children:e.map(e=>(0,s.jsx)(j.ck,{p:3,borderWidth:1,borderRadius:"md",bg:"done"===e.status?"green.50":"error"===e.status?"red.50":"white",children:(0,s.jsxs)(S.z,{justify:"space-between",children:[(0,s.jsxs)(a.T,{align:"start",flex:1,children:[(0,s.jsxs)(S.z,{children:[(0,s.jsx)(g.E,{fontWeight:"medium",noOfLines:1,children:e.file.name}),(0,s.jsxs)(g.E,{color:"gray.500",fontSize:"sm",children:["(",O(e.file.size),")"]})]}),"initializing"===e.status&&(0,s.jsxs)(a.T,{spacing:2,width:"100%",children:[(0,s.jsx)(b.k,{isIndeterminate:!0,size:"sm",width:"100%",colorScheme:"orange"}),(0,s.jsx)(g.E,{fontSize:"xs",color:"orange.600",children:"正在初始化上传任务..."})]}),"uploading"===e.status&&(0,s.jsxs)(a.T,{spacing:2,width:"100%",children:[(0,s.jsx)(b.k,{value:e.progress,size:"sm",width:"100%",colorScheme:"backend"===e.progressSource?"green":"blue"}),(0,s.jsxs)(S.z,{justify:"space-between",width:"100%",fontSize:"xs",color:"gray.600",children:[(0,s.jsxs)(g.E,{children:[e.uploadedBytes?O(e.uploadedBytes):"0 B"," / ",O(e.file.size)]}),(0,s.jsxs)(g.E,{children:[e.progress.toFixed(1),"%"]})]}),(0,s.jsxs)(S.z,{justify:"space-between",width:"100%",fontSize:"xs",color:"gray.600",children:[(0,s.jsxs)(g.E,{children:["速度: ",e.uploadSpeed?W(e.uploadSpeed):"计算中..."]}),(0,s.jsxs)(g.E,{children:["剩余: ",e.estimatedTimeRemaining?H(e.estimatedTimeRemaining):"--"]})]}),(0,s.jsxs)(S.z,{justify:"center",width:"100%",fontSize:"xs",children:["frontend"===e.progressSource&&(0,s.jsx)(g.E,{color:"blue.500",children:"\uD83D\uDCE4 正在传输到服务器..."}),"backend"===e.progressSource&&(0,s.jsx)(g.E,{color:"green.500",children:"⚡ 服务器处理中..."})]})]}),"error"===e.status&&(0,s.jsx)(g.E,{color:"red.500",fontSize:"sm",children:e.error||"上传失败"})]}),(0,s.jsx)(y.K,{"aria-label":"Remove file",icon:(0,s.jsx)(z.yGN,{}),size:"sm",variant:"ghost",isDisabled:t&&("initializing"===e.status||"uploading"===e.status),onClick:()=>eo(e.id)})]})},e.id))})]}),(0,s.jsx)(E.$,{leftIcon:(0,s.jsx)(z.B88,{}),colorScheme:"blue",size:"lg",onClick:eu,isLoading:t,loadingText:"上传中...",isDisabled:0===e.length||t,children:"开始上传"})]}),(0,s.jsx)(A,{isOpen:G,onClose:()=>{q(!1),Z&&Z(!1),K(null),Q(null),V(null)},onConfirm:ed,newFile:null==$?void 0:$.file,existingFile:null==J?void 0:J.existing_file})]})}},96918:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var s=t(23464),o=t(7161),n=t(49509);let l=s.A.create({baseURL:n.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let r=localStorage.getItem("token");r&&(e.headers.Authorization="Bearer ".concat(r))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),l.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let r=e.data;return r&&"object"==typeof r&&void 0!==r.code?0!==r.code&&200!==r.code?(console.error("API响应错误:",r),Promise.reject(Error(r.message||"请求失败"))):r:e},e=>{var r,t,s;return console.error("请求失败:",{url:null===(r=e.config)||void 0===r?void 0:r.url,message:e.message,response:null===(t=e.response)||void 0===t?void 0:t.data}),e.response?401===e.response.status?(0,o.Hl)():console.error("API错误:",(null===(s=e.response.data)||void 0===s?void 0:s.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let i=l}},e=>{var r=r=>e(e.s=r);e.O(0,[844,8791,6829,6980,7039,2210,3464,3513,5670,8441,1684,7358],()=>r(22954)),_N_E=e.O()}]);