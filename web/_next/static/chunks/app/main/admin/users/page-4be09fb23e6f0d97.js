(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5197],{7161:(e,s,r)=>{"use strict";r.d(s,{HY:()=>a,Hl:()=>t});let t=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},a=e=>{var s;return e&&"object"==typeof e&&"response"in e&&(null===(s=e.response)||void 0===s?void 0:s.status)===401}},7283:(e,s,r)=>{"use strict";r.d(s,{IW:()=>l,NR:()=>o,QS:()=>a});var t=r(96918);let a={getUsers:async e=>{console.log("UserAPI.getUsers called with params:",e);let s=await t.A.get("/users",{params:e});return console.log("UserAPI.getUsers raw response:",s),s.data},getUser:async e=>(await t.A.get("/users/".concat(e))).data,createUser:async e=>(await t.A.post("/users",e)).data,updateUser:async(e,s)=>(await t.A.put("/users/".concat(e),s)).data,deleteUser:async e=>{await t.A.delete("/users/".concat(e))}},o={getRoles:async e=>{try{let o=(await t.A.get("/roles",{params:e})).data;if(o&&o.data&&Array.isArray(o.data.items)){let e=o.data.items.map(e=>{var s,r,t;return{id:e.id,name:null!==(s=e.name)&&void 0!==s?s:"",description:null!==(r=e.description)&&void 0!==r?r:"",permissions:Array.isArray(e.permissions)?e.permissions:[],created_at:null!==(t=e.created_at)&&void 0!==t?t:"",...e}});return{roles:e,total:e.length}}if(Array.isArray(o)){let e=o.map(e=>{var s,r,t;return{id:e.id,name:null!==(s=e.name)&&void 0!==s?s:"",description:null!==(r=e.description)&&void 0!==r?r:"",permissions:Array.isArray(e.permissions)?e.permissions:[],created_at:null!==(t=e.created_at)&&void 0!==t?t:"",...e}});return{roles:e,total:e.length}}if(o&&"object"==typeof o&&o.id){var s,r,a;return{roles:[{id:o.id,name:null!==(s=o.name)&&void 0!==s?s:"",description:null!==(r=o.description)&&void 0!==r?r:"",permissions:Array.isArray(o.permissions)?o.permissions:[],created_at:null!==(a=o.created_at)&&void 0!==a?a:"",...o}],total:1}}return{roles:[],total:0}}catch(e){return{roles:[],total:0}}},getRole:async e=>(await t.A.get("/roles/".concat(e))).data,createRole:async e=>(await t.A.post("/roles",e)).data,updateRole:async(e,s)=>(await t.A.put("/roles/".concat(e),s)).data,deleteRole:async e=>{await t.A.delete("/roles/".concat(e))},getRegionBucketMappings:async e=>(await t.A.get("/region-bucket-mappings",{params:e})).data,getRoleRegionBucketAccess:async e=>(await t.A.get("/roles/".concat(e,"/bucket-access"))).data,updateRoleRegionBucketAccess:async(e,s)=>{await t.A.put("/roles/".concat(e,"/bucket-access"),s)},deleteRoleRegionBucketAccess:async(e,s)=>{await t.A.delete("/roles/".concat(e,"/accessible-buckets/").concat(s))}},l={getPermissions:async e=>{try{let s=await t.A.get("/permissions",{params:e});if(console.log("PermissionAPI.getPermissions response:",s),console.log("PermissionAPI.getPermissions response.data:",s.data),s.data&&s.data.items)return console.log("PermissionAPI.getPermissions response.data.items:",s.data.items),{permissions:s.data.items,total:s.data.total};if(Array.isArray(s.data))return{permissions:s.data,total:s.data.length};return{permissions:[],total:0}}catch(e){throw console.error("PermissionAPI.getPermissions error:",e),e}},getPermission:async e=>(await t.A.get("/permissions/".concat(e))).data,createPermission:async e=>(await t.A.post("/permissions",e)).data,updatePermission:async(e,s)=>(await t.A.put("/permissions/".concat(e),s)).data,deletePermission:async e=>{await t.A.delete("/permissions/".concat(e))}}},86979:(e,s,r)=>{Promise.resolve().then(r.bind(r,95316))},89342:(e,s,r)=>{"use strict";r.d(s,{O:()=>p});var t=r(95155),a=r(12115),o=r(35695),l=r(96918),n=r(7161);let i=()=>{let[e,s]=(0,a.useState)(null),[r,t]=(0,a.useState)(!0),i=(0,o.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("user"),r=localStorage.getItem("token");if(r&&!document.cookie.includes("token=")&&(document.cookie="token=".concat(r,"; path=/; ").concat("secure;"," samesite=strict; max-age=86400")),e)try{let r=JSON.parse(e);r&&r.permissions&&(s(r),t(!1))}catch(e){console.error("解析本地用户数据失败:",e)}c()},[]);let c=async()=>{try{let e=(await l.A.get("/user/current")).data;if(e&&e.permissions){let r={...e,permissions:Array.isArray(e.permissions)?e.permissions:[]};s(r),localStorage.setItem("user",JSON.stringify(r))}else{let e=localStorage.getItem("user");if(e){let r=JSON.parse(e);s(r)}else i.push("/auth/login")}}catch(r){if(console.error("认证检查失败:",r),(0,n.HY)(r)){s(null),(0,n.Hl)();return}let e=localStorage.getItem("user");e?s(JSON.parse(e)):i.push("/auth/login")}finally{t(!1)}},d=(s,r)=>!!e&&!!e.permissions&&e.permissions.some(e=>r?e.resource===s&&e.action===r:e.resource===s);return{user:e,loading:r,hasPermission:d,hasManagerPermission:()=>d("MANAGER"),logout:()=>{localStorage.removeItem("user"),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",s(null),i.push("/auth/login")},checkAuth:c}};var c=r(77700),d=r(84492),u=r(79788),m=r(21688),h=r(75569),g=r(58670);let p=e=>{let{children:s,requiredPermission:r,requireManager:a=!1,fallbackPath:l="/main/dashboard"}=e,{user:n,loading:p,hasPermission:j,hasManagerPermission:x}=i(),y=(0,o.useRouter)();return p?(0,t.jsx)(c.a,{minH:"100vh",display:"flex",alignItems:"center",justifyContent:"center",children:(0,t.jsx)(d.y,{size:"lg",color:"blue.500"})}):n?a&&!x()?(0,t.jsx)(c.a,{p:8,children:(0,t.jsxs)(u.F,{status:"error",children:[(0,t.jsx)(m._,{}),(0,t.jsxs)(h.T,{align:"start",spacing:2,children:[(0,t.jsx)(g.E,{fontWeight:"bold",children:"访问被拒绝"}),(0,t.jsx)(g.E,{children:"您没有访问此页面的权限。需要管理员权限。"})]})]})}):r&&!j(r.resource,r.action)?(0,t.jsx)(c.a,{p:8,children:(0,t.jsxs)(u.F,{status:"error",children:[(0,t.jsx)(m._,{}),(0,t.jsxs)(h.T,{align:"start",spacing:2,children:[(0,t.jsx)(g.E,{fontWeight:"bold",children:"访问被拒绝"}),(0,t.jsxs)(g.E,{children:["您没有访问此页面的权限。需要权限: ",r.resource,r.action&&" - ".concat(r.action)]})]})]})}):(0,t.jsx)(t.Fragment,{children:s}):(y.push("/auth/login"),null)}},95316:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>Q});var t=r(95155),a=r(12115),o=r(23006),l=r(52017),n=r(77700),i=r(58727),c=r(42066),d=r(49747),u=r(33636),m=r(77978),h=r(37824),g=r(83382),p=r(47272),j=r(76122),x=r(66080),y=r(24710),f=r(80436),v=r(58670),w=r(35490),A=r(39376),S=r(84002),k=r(91985),b=r(29358),C=r(32643),I=r(7283),E=r(89342),R=r(25442),P=r(64688),T=r(61549),z=r(27104),_=r(19782),U=r(5643),M=r(75569),N=r(26418),Z=r(79175),O=r(3740),W=r(52019),J=r(86697),L=r(26584),q=r(49174),$=r(58388);function H(e){let{isOpen:s,onClose:r,user:l,onSuccess:i}=e,[h,g]=(0,a.useState)(""),[p,j]=(0,a.useState)(""),[x,y]=(0,a.useState)(""),[f,A]=(0,a.useState)(""),[S,k]=(0,a.useState)(!0),[b,C]=(0,a.useState)([]),[E,H]=(0,a.useState)([]),[B,Q]=(0,a.useState)(!1),[D,F]=(0,a.useState)({}),[K,G]=(0,a.useState)({score:0,level:"weak",feedback:[]}),[Y,X]=(0,a.useState)(!1),V=(0,o.d)(),[ee,es]=(0,a.useState)({}),er=(0,a.useCallback)((e,s,r)=>{ee[e]&&clearTimeout(ee[e]);let t=setTimeout(()=>{r()},300);es(s=>({...s,[e]:t}))},[ee]);(0,a.useEffect)(()=>{l?(g(l.username),y(l.email),A(l.real_name||""),k(l.status),H(Array.isArray(l.roles)?l.roles.map(e=>e.id):[])):(g(""),j(""),y(""),A(""),k(!0),H([])),F({}),G({score:0,level:"weak",feedback:[]})},[l]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=await I.NR.getRoles({page:1,limit:100});C(e.roles||[])}catch(e){V({title:"获取角色列表失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}};s&&e()},[s,V]),(0,a.useEffect)(()=>()=>{Object.values(ee).forEach(e=>clearTimeout(e))},[ee]);let et=e=>{if(!e)return{score:0,level:"weak",feedback:["请输入密码"]};let s=0,r=[];e.length>=8?s+=1:e.length>=6?s+=.5:r.push("密码长度至少需要6个字符"),/[a-z]/.test(e)?s+=1:r.push("必须包含小写字母"),/[A-Z]/.test(e)?s+=1:r.push("必须包含大写字母"),/[0-9]/.test(e)?s+=1:r.push("必须包含数字"),/[^a-zA-Z0-9]/.test(e)?s+=1:r.push("必须包含特殊字符"),/(.)\1{2,}/.test(e)&&(s-=.5,r.push("避免重复字符")),/123|abc|qwe|password|admin/i.test(e)&&(s-=1,r.push("避免常见密码模式"));let t="weak";return s>=4.5?t="very-strong":s>=3.5?t="strong":s>=2.5&&(t="medium"),{score:Math.max(0,Math.min(5,s)),level:t,feedback:r}},ea=(0,a.useCallback)(e=>e||l?e.length<3?{message:"用户名至少需要3个字符",type:"error"}:e.length>32?{message:"用户名不能超过32个字符",type:"error"}:/^[a-zA-Z0-9_-]+$/.test(e)?["admin","root","administrator","system","guest","user","test","demo"].includes(e.toLowerCase())?{message:"此用户名为系统保留用户名",type:"warning"}:null:{message:"用户名只能包含字母、数字、下划线和连字符",type:"error"}:{message:"用户名不能为空",type:"error"},[l]),eo=(0,a.useCallback)(e=>{var s;if(!e)return{message:"邮箱不能为空",type:"error"};if(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e))return{message:"邮箱格式不正确",type:"error"};let r=null===(s=e.split("@")[1])||void 0===s?void 0:s.toLowerCase();return r&&!["gmail.com","yahoo.com","hotmail.com","outlook.com","163.com","qq.com"].includes(r)&&r.includes(".co")?{message:"请检查邮箱域名是否正确",type:"warning"}:null},[]),el=(0,a.useCallback)(e=>e&&e.length>50?{message:"真实姓名不能超过50个字符",type:"error"}:e&&/<[^>]*>/.test(e)?{message:"姓名不能包含HTML标签",type:"error"}:null,[]),en=()=>{let e={};if(!l){let s=ea(h);s&&(e.username=s)}if(!l){if(p){if(p.length<6)e.password={message:"密码至少需要6个字符",type:"error"};else if(p.length>32)e.password={message:"密码不能超过32个字符",type:"error"};else{let s=/[a-z]/.test(p),r=/[A-Z]/.test(p),t=/[0-9]/.test(p),a=/[^a-zA-Z0-9]/.test(p);s?r?t?a||(e.password={message:"密码必须包含特殊字符",type:"error"}):e.password={message:"密码必须包含数字",type:"error"}:e.password={message:"密码必须包含大写字母",type:"error"}:e.password={message:"密码必须包含小写字母",type:"error"}}}else e.password={message:"密码不能为空",type:"error"}}let s=eo(x);s&&(e.email=s);let r=el(f);return r&&(e.realName=r),0===E.length&&(e.roles={message:"请至少选择一个角色",type:"warning"}),F(e),!Object.values(e).some(e=>"error"===e.type)},ei=e=>{g(e),l||er("username",e,()=>{let s=ea(e);F(e=>s?{...e,username:s}:{...e,username:void 0})})},ec=e=>{j(e),G(et(e)),er("password",e,()=>{let s=null;if(e){if(e.length<6)s={message:"密码至少需要6个字符",type:"error"};else if(e.length>32)s={message:"密码不能超过32个字符",type:"error"};else{let r=/[a-z]/.test(e),t=/[A-Z]/.test(e),a=/[0-9]/.test(e),o=/[^a-zA-Z0-9]/.test(e);r?t?a?o||(s={message:"密码必须包含特殊字符",type:"error"}):s={message:"密码必须包含数字",type:"error"}:s={message:"密码必须包含大写字母",type:"error"}:s={message:"密码必须包含小写字母",type:"error"}}}else s={message:"密码不能为空",type:"error"};F(e=>s?{...e,password:s}:{...e,password:void 0})})},ed=e=>{y(e),er("email",e,()=>{let s=eo(e);F(e=>s?{...e,email:s}:{...e,email:void 0})})},eu=e=>{A(e),er("realName",e,()=>{let s=el(e);F(e=>s?{...e,realName:s}:{...e,realName:void 0})})},em=async()=>{if(X(!0),!en()){X(!1);return}try{Q(!0),l?(await I.QS.updateUser(l.id,{email:x,real_name:f,status:S,role_ids:E}),V({title:"更新成功",status:"success",duration:3e3,isClosable:!0})):(await I.QS.createUser({username:h,password:p,email:x,real_name:f,role_ids:E}),V({title:"创建成功",status:"success",duration:3e3,isClosable:!0})),i(),r()}catch(e){V({title:l?"更新失败":"创建失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}finally{Q(!1),X(!1)}},eh=(e,s)=>{let r=s?[...E,e]:E.filter(s=>s!==e);H(r),r.length>0&&D.roles&&F(e=>({...e,roles:void 0}))};return(0,t.jsxs)(R.aF,{isOpen:s,onClose:r,size:"xl",children:[(0,t.jsx)(P.m,{}),(0,t.jsxs)(T.$,{children:[(0,t.jsx)(z.r,{children:l?"编辑用户":"新建用户"}),(0,t.jsx)(_.s,{}),(0,t.jsx)(U.c,{children:(0,t.jsxs)(M.T,{spacing:4,children:[(0,t.jsxs)(N.MJ,{isRequired:!l,isInvalid:!!D.username&&"error"===D.username.type,children:[(0,t.jsx)(Z.l,{children:"用户名"}),(0,t.jsxs)(c.M,{children:[(0,t.jsx)(u.p,{value:h,onChange:e=>ei(e.target.value),placeholder:"请输入用户名 (3-32个字符)",isDisabled:!!l,autoComplete:"off"}),!l&&h&&!D.username&&(0,t.jsx)(d.t,{children:(0,t.jsx)(O.I,{as:$.S,color:"green.500"})})]}),D.username&&(0,t.jsx)(W.Wt,{color:"warning"===D.username.type?"orange.500":"red.500",children:D.username.message}),!l&&(0,t.jsx)(N.eK,{fontSize:"sm",color:"gray.500",children:"用户名只能包含字母、数字、下划线和连字符"})]}),!l&&(0,t.jsxs)(N.MJ,{isRequired:!0,isInvalid:!!D.password&&"error"===D.password.type,children:[(0,t.jsx)(Z.l,{children:"密码"}),(0,t.jsx)(u.p,{type:"password",value:p,onChange:e=>ec(e.target.value),placeholder:"请输入密码 (6-32个字符)",autoComplete:"off"}),p&&(0,t.jsxs)(n.a,{mt:2,children:[(0,t.jsxs)(v.E,{fontSize:"sm",mb:1,children:["密码强度: ",(()=>{switch(K.level){case"very-strong":return"非常强";case"strong":return"强";case"medium":return"中等";case"weak":return"弱";default:return""}})()]}),(0,t.jsx)(J.k,{value:K.score/5*100,colorScheme:(()=>{switch(K.level){case"very-strong":return"green";case"strong":return"blue";case"medium":return"yellow";case"weak":return"red";default:return"gray"}})(),size:"sm",borderRadius:"md"}),K.feedback.length>0&&(0,t.jsx)(n.a,{mt:1,children:K.feedback.map((e,s)=>(0,t.jsxs)(v.E,{fontSize:"xs",color:"gray.500",children:["• ",e]},s))})]}),D.password&&(0,t.jsx)(W.Wt,{color:"warning"===D.password.type?"orange.500":"red.500",children:D.password.message})]}),(0,t.jsxs)(N.MJ,{isRequired:!0,isInvalid:!!D.email&&"error"===D.email.type,children:[(0,t.jsx)(Z.l,{children:"邮箱"}),(0,t.jsxs)(c.M,{children:[(0,t.jsx)(u.p,{type:"email",value:x,onChange:e=>ed(e.target.value),placeholder:"请输入邮箱地址"}),x&&!D.email&&(0,t.jsx)(d.t,{children:(0,t.jsx)(O.I,{as:$.S,color:"green.500"})})]}),D.email&&(0,t.jsx)(W.Wt,{color:"warning"===D.email.type?"orange.500":"red.500",children:D.email.message})]}),(0,t.jsxs)(N.MJ,{isInvalid:!!D.realName,children:[(0,t.jsx)(Z.l,{children:"真实姓名"}),(0,t.jsx)(u.p,{value:f,onChange:e=>eu(e.target.value),placeholder:"请输入真实姓名 (可选)",maxLength:50}),D.realName&&(0,t.jsx)(W.Wt,{children:D.realName.message}),(0,t.jsxs)(N.eK,{fontSize:"sm",color:"gray.500",children:[f.length,"/50 字符"]})]}),(0,t.jsxs)(N.MJ,{children:[(0,t.jsx)(Z.l,{children:"状态"}),(0,t.jsx)(w.d,{isChecked:S,onChange:e=>k(e.target.checked),colorScheme:"green"}),(0,t.jsx)(N.eK,{children:S?"启用":"禁用"})]}),(0,t.jsxs)(N.MJ,{isInvalid:!!D.roles,children:[(0,t.jsx)(Z.l,{children:"角色"}),(0,t.jsx)(n.a,{maxH:"200px",overflowY:"auto",borderWidth:1,borderRadius:"md",p:4,children:(0,t.jsx)(M.T,{align:"start",spacing:2,children:b.map(e=>(0,t.jsx)(L.S,{isChecked:E.includes(e.id),onChange:s=>eh(e.id,s.target.checked),children:(0,t.jsxs)(n.a,{children:[(0,t.jsx)(v.E,{fontWeight:"medium",children:e.name}),e.description&&(0,t.jsx)(v.E,{fontSize:"sm",color:"gray.500",children:e.description})]})},e.id))})}),D.roles&&(0,t.jsx)(W.Wt,{color:"warning"===D.roles.type?"orange.500":"red.500",children:D.roles.message})]})]})}),(0,t.jsxs)(q.j,{children:[(0,t.jsx)(m.$,{variant:"ghost",mr:3,onClick:r,children:"取消"}),(0,t.jsx)(m.$,{colorScheme:"blue",onClick:em,isLoading:B||Y,loadingText:Y?"验证中...":"保存中...",children:"保存"})]})]})]})}function B(){let[e,s]=(0,a.useState)([]),[r,E]=(0,a.useState)(0),[R,P]=(0,a.useState)(1),[T,z]=(0,a.useState)(10),[_,U]=(0,a.useState)(""),[M,N]=(0,a.useState)(!1),Z=(0,o.d)(),{isOpen:O,onOpen:W,onClose:J}=(0,l.j)(),[L,q]=(0,a.useState)(null),$=async()=>{try{N(!0),console.log("Fetching users with params:",{page:R,limit:T,search:_});let e=await I.QS.getUsers({page:R,limit:T,search:_||void 0});if(console.log("Raw API Response:",e),!e)throw console.error("Response is null or undefined"),Error("Empty API response");if(!e.items)throw console.error("Response missing items array:",e),Error("Invalid API response: missing items array");if(!Array.isArray(e.items))throw console.error("Response items is not an array:",e.items),Error("Invalid API response: items is not an array");console.log("Response items:",e.items),console.log("Response total:",e.total);let r=e.items.map(e=>{var s;return console.log("Processing user:",e),{...e,roles:Array.isArray(e.roles)?e.roles:[],real_name:e.real_name||"",status:null===(s=e.status)||void 0===s||s,created_at:e.created_at||new Date().toISOString()}});console.log("Processed users:",r),s(r),E(e.total||r.length)}catch(e){console.error("Error fetching users:",e),e instanceof Error&&console.error("Error details:",{message:e.message,stack:e.stack}),Z({title:"获取用户列表失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}finally{N(!1)}};(0,a.useEffect)(()=>{$()},[R,T,_]);let B=e=>{U(e),P(1)},Q=e=>{q(e),W()},D=async e=>{if(confirm("确定要删除该用户吗？"))try{await I.QS.deleteUser(e),Z({title:"删除成功",status:"success",duration:3e3,isClosable:!0}),$()}catch(e){Z({title:"删除失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}},F=async e=>{try{await I.QS.updateUser(e.id,{status:!e.status}),Z({title:"更新成功",status:"success",duration:3e3,isClosable:!0}),$()}catch(e){Z({title:"更新失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}},K=Math.ceil(r/T),G=R>1,Y=R<K;return(0,t.jsxs)(n.a,{p:4,children:[(0,t.jsxs)(i.z,{mb:4,justify:"space-between",children:[(0,t.jsxs)(c.M,{maxW:"300px",children:[(0,t.jsx)(d.W,{pointerEvents:"none",children:(0,t.jsx)(S.W,{color:"gray.300"})}),(0,t.jsx)(u.p,{placeholder:"搜索用户...",value:_,onChange:e=>B(e.target.value)})]}),(0,t.jsx)(m.$,{leftIcon:(0,t.jsx)(k.R,{}),colorScheme:"blue",onClick:()=>{q(null),W()},children:"新建用户"})]}),(0,t.jsxs)(h.X,{variant:"simple",children:[(0,t.jsx)(g.d,{children:(0,t.jsxs)(p.Tr,{children:[(0,t.jsx)(j.Th,{children:"用户名"}),(0,t.jsx)(j.Th,{children:"邮箱"}),(0,t.jsx)(j.Th,{children:"真实姓名"}),(0,t.jsx)(j.Th,{children:"角色"}),(0,t.jsx)(j.Th,{children:"状态"}),(0,t.jsx)(j.Th,{children:"创建时间"}),(0,t.jsx)(j.Th,{children:"操作"})]})}),(0,t.jsx)(x.N,{children:e.map(e=>(0,t.jsxs)(p.Tr,{children:[(0,t.jsx)(y.Td,{children:e.username}),(0,t.jsx)(y.Td,{children:e.email}),(0,t.jsx)(y.Td,{children:e.real_name||"-"}),(0,t.jsx)(y.Td,{children:(0,t.jsx)(i.z,{spacing:1,children:e.roles&&e.roles.length>0?e.roles.map(e=>(0,t.jsx)(f.E,{colorScheme:"blue",children:e.name},e.id)):(0,t.jsx)(v.E,{color:"gray.500",children:"无角色"})})}),(0,t.jsx)(y.Td,{children:(0,t.jsx)(w.d,{isChecked:e.status,onChange:()=>F(e),colorScheme:"green"})}),(0,t.jsx)(y.Td,{children:new Date(e.created_at).toLocaleString()}),(0,t.jsx)(y.Td,{children:(0,t.jsxs)(i.z,{spacing:2,children:[(0,t.jsx)(A.K,{"aria-label":"编辑用户",icon:(0,t.jsx)(b.q,{}),size:"sm",onClick:()=>Q(e)}),(0,t.jsx)(A.K,{"aria-label":"删除用户",icon:(0,t.jsx)(C.d,{}),size:"sm",colorScheme:"red",onClick:()=>D(e.id)})]})})]},e.id))})]}),(0,t.jsxs)(i.z,{justify:"space-between",mt:4,children:[(0,t.jsxs)(v.E,{children:["第 ",R," 页，共 ",K," 页"]}),(0,t.jsxs)(i.z,{children:[(0,t.jsx)(m.$,{size:"sm",onClick:()=>P(R-1),isDisabled:!G,children:"上一页"}),(0,t.jsx)(m.$,{size:"sm",onClick:()=>P(R+1),isDisabled:!Y,children:"下一页"})]})]}),(0,t.jsx)(H,{isOpen:O,onClose:J,user:L,onSuccess:$})]})}function Q(){return(0,t.jsx)(E.O,{requireManager:!0,children:(0,t.jsx)(B,{})})}},96918:(e,s,r)=>{"use strict";r.d(s,{A:()=>n});var t=r(23464),a=r(7161),o=r(87358);let l=t.A.create({baseURL:o.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let s=localStorage.getItem("token");s&&(e.headers.Authorization="Bearer ".concat(s))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),l.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let s=e.data;return s&&"object"==typeof s&&void 0!==s.code?0!==s.code&&200!==s.code?(console.error("API响应错误:",s),Promise.reject(Error(s.message||"请求失败"))):s:e},e=>{var s,r,t;return console.error("请求失败:",{url:null===(s=e.config)||void 0===s?void 0:s.url,message:e.message,response:null===(r=e.response)||void 0===r?void 0:r.data}),e.response?401===e.response.status?(0,a.Hl)():console.error("API错误:",(null===(t=e.response.data)||void 0===t?void 0:t.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let n=l}},e=>{var s=s=>e(e.s=s);e.O(0,[8791,6829,6980,7039,2210,3464,3513,8277,5030,4432,8441,1684,7358],()=>s(86979)),_N_E=e.O()}]);