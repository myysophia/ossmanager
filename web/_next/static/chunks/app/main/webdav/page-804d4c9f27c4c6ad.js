(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9058],{7161:(e,s,r)=>{"use strict";r.d(s,{HY:()=>i,Hl:()=>n});let n=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},i=e=>{var s;return e&&"object"==typeof e&&"response"in e&&(null===(s=e.response)||void 0===s?void 0:s.status)===401}},34655:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>X});var n=r(95155),i=r(12115),t=r(52017),l=r(23006),a=r(77700),c=r(75569),o=r(59108),d=r(11649),h=r(92998),x=r(77978),j=r(79788),u=r(21688),b=r(58670),m=r(29826),g=r(22274),p=r(24369),v=r(37824),k=r(83382),w=r(47272),f=r(76122),C=r(66080),T=r(24710),y=r(42104),E=r(58727),D=r(99785),S=r(39376),A=r(80436),z=r(25442),_=r(64688),W=r(61549),L=r(27104),I=r(19782),P=r(5643),V=r(26418),B=r(79175),F=r(4316),O=r(23833),R=r(49174),U=r(6126),$=r(40988),K=r(96065),N=r(62833),Z=r(93176),H=r(96918);let J={createToken:async e=>(await H.A.post("/webdav/token",e)).data.data,listTokens:async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new URLSearchParams;return e&&r.append("bucket",e),s&&r.append("include_expired","true"),(await H.A.get("/webdav/token?".concat(r.toString()))).data.data},deleteToken:async e=>{await H.A.delete("/webdav/token/".concat(e))},getAccessibleBuckets:async()=>(await H.A.get("/oss/region-buckets/user-accessible")).data.data};var M=r(99539),q=r(74093),Q=r(32643);function X(){let[e,s]=(0,i.useState)([]),[r,H]=(0,i.useState)([]),[X,G]=(0,i.useState)(!1),[Y,ee]=(0,i.useState)(""),[es,er]=(0,i.useState)(null),[en,ei]=(0,i.useState)(24),{isOpen:et,onOpen:el,onClose:ea}=(0,t.j)(),ec=(0,l.d)();(0,i.useEffect)(()=>{eo(),ed()},[]);let eo=async()=>{try{let e=await J.getAccessibleBuckets();s(e)}catch(e){ec({title:"加载存储桶失败",description:"无法获取可访问的存储桶列表",status:"error",duration:5e3,isClosable:!0})}},ed=async()=>{try{let e=await J.listTokens();H(e)}catch(e){ec({title:"加载令牌失败",description:"无法获取WebDAV令牌列表",status:"error",duration:5e3,isClosable:!0})}},eh=async()=>{if(!Y){ec({title:"请选择存储桶",status:"warning",duration:3e3,isClosable:!0});return}G(!0);try{let e=await J.createToken({bucket:Y,expires_in:en});er(e),ed(),ec({title:"令牌创建成功",description:"请复制并保存令牌，它将不会再次显示",status:"success",duration:5e3,isClosable:!0})}catch(e){ec({title:"创建令牌失败",description:"无法创建WebDAV访问令牌",status:"error",duration:5e3,isClosable:!0})}finally{G(!1)}},ex=async e=>{if(confirm("确定要删除这个令牌吗？"))try{await J.deleteToken(e),ed(),ec({title:"令牌删除成功",status:"success",duration:3e3,isClosable:!0})}catch(e){ec({title:"删除令牌失败",status:"error",duration:5e3,isClosable:!0})}},ej=async e=>{try{await navigator.clipboard.writeText(e),ec({title:"已复制到剪贴板",status:"success",duration:2e3,isClosable:!0})}catch(e){ec({title:"复制失败",status:"error",duration:2e3,isClosable:!0})}},eu=e=>"".concat(window.location.origin,"/webdav/").concat(e),eb=e=>new Date(e).toLocaleString(),em=e=>new Date(e)<new Date;return(0,n.jsx)(a.a,{p:6,children:(0,n.jsxs)(c.T,{spacing:6,align:"stretch",children:[(0,n.jsxs)(o.s,{align:"center",children:[(0,n.jsx)(d.D,{size:"lg",children:"WebDAV 访问管理"}),(0,n.jsx)(h.h,{}),(0,n.jsx)(x.$,{as:"a",href:"https://github.com/myysophia/ossmanager/blob/main/docs/webdav-usage.md",target:"_blank",rel:"noopener noreferrer",leftIcon:(0,n.jsx)(M.p,{}),variant:"outline",mr:3,children:"\uD83D\uDCC4 使用指南"}),(0,n.jsx)(x.$,{colorScheme:"blue",onClick:el,children:"创建新令牌"})]}),(0,n.jsxs)(j.F,{status:"info",borderRadius:"lg",children:[(0,n.jsx)(u._,{}),(0,n.jsxs)(a.a,{children:[(0,n.jsx)(b.E,{fontWeight:"bold",mb:1,children:"需要帮助？"}),(0,n.jsx)(b.E,{fontSize:"sm",mb:2,children:"查看完整的 WebDAV 使用指南，包含详细的挂载示例、认证配置和常见问题解决方案。"}),(0,n.jsx)(x.$,{as:"a",href:"https://github.com/myysophia/ossmanager/blob/main/docs/webdav-usage.md",target:"_blank",rel:"noopener noreferrer",size:"sm",leftIcon:(0,n.jsx)(M.p,{}),colorScheme:"blue",variant:"outline",children:"\uD83D\uDCD6 阅读完整指南"})]})]}),(0,n.jsxs)(m.Z,{children:[(0,n.jsx)(g.a,{children:(0,n.jsx)(d.D,{size:"md",children:"访问令牌列表"})}),(0,n.jsx)(p.b,{children:0===r.length?(0,n.jsx)(b.E,{color:"gray.500",textAlign:"center",py:8,children:"暂无WebDAV访问令牌"}):(0,n.jsxs)(v.X,{variant:"simple",children:[(0,n.jsx)(k.d,{children:(0,n.jsxs)(w.Tr,{children:[(0,n.jsx)(f.Th,{children:"存储桶"}),(0,n.jsx)(f.Th,{children:"WebDAV地址"}),(0,n.jsx)(f.Th,{children:"创建时间"}),(0,n.jsx)(f.Th,{children:"过期时间"}),(0,n.jsx)(f.Th,{children:"状态"}),(0,n.jsx)(f.Th,{children:"操作"})]})}),(0,n.jsx)(C.N,{children:r.map(e=>(0,n.jsxs)(w.Tr,{children:[(0,n.jsx)(T.Td,{children:(0,n.jsx)(y.C,{children:e.bucket})}),(0,n.jsx)(T.Td,{children:(0,n.jsxs)(E.z,{children:[(0,n.jsx)(y.C,{fontSize:"sm",children:eu(e.bucket)}),(0,n.jsx)(D.m,{label:"复制地址",children:(0,n.jsx)(S.K,{"aria-label":"Copy URL",icon:(0,n.jsx)(q.T,{}),size:"sm",variant:"ghost",onClick:()=>ej(eu(e.bucket))})})]})}),(0,n.jsx)(T.Td,{children:eb(e.created_at)}),(0,n.jsx)(T.Td,{children:eb(e.expires_at)}),(0,n.jsx)(T.Td,{children:(0,n.jsx)(A.E,{colorScheme:em(e.expires_at)?"red":"green",children:em(e.expires_at)?"已过期":"有效"})}),(0,n.jsx)(T.Td,{children:(0,n.jsx)(D.m,{label:"删除令牌",children:(0,n.jsx)(S.K,{"aria-label":"Delete token",icon:(0,n.jsx)(Q.d,{}),size:"sm",colorScheme:"red",variant:"ghost",onClick:()=>ex(e.id)})})})]},e.id))})]})})]}),(0,n.jsxs)(z.aF,{isOpen:et,onClose:ea,size:"lg",children:[(0,n.jsx)(_.m,{}),(0,n.jsxs)(W.$,{children:[(0,n.jsx)(L.r,{children:"创建WebDAV访问令牌"}),(0,n.jsx)(I.s,{}),(0,n.jsx)(P.c,{children:(0,n.jsxs)(c.T,{spacing:4,children:[(0,n.jsxs)(V.MJ,{children:[(0,n.jsx)(B.l,{children:"存储桶"}),(0,n.jsx)(F.l,{placeholder:"选择存储桶",value:Y,onChange:e=>ee(e.target.value),children:e.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)(V.MJ,{children:[(0,n.jsx)(B.l,{children:"过期时间（小时）"}),(0,n.jsxs)(O.Q7,{value:en,onChange:(e,s)=>ei(s||24),min:1,max:720,children:[(0,n.jsx)(O.OO,{}),(0,n.jsxs)(O.lw,{children:[(0,n.jsx)(O.Q0,{}),(0,n.jsx)(O.Sh,{})]})]}),(0,n.jsx)(b.E,{fontSize:"sm",color:"gray.500",mt:1,children:"最大720小时（30天）"})]}),es&&(0,n.jsxs)(j.F,{status:"success",children:[(0,n.jsx)(u._,{}),(0,n.jsxs)(a.a,{children:[(0,n.jsx)(b.E,{fontWeight:"bold",mb:2,children:"令牌创建成功！"}),(0,n.jsx)(b.E,{fontSize:"sm",mb:2,children:"请复制并保存以下令牌，它将不会再次显示："}),(0,n.jsxs)(E.z,{children:[(0,n.jsx)(y.C,{p:2,fontSize:"sm",wordBreak:"break-all",children:es.token}),(0,n.jsx)(x.$,{size:"sm",leftIcon:(0,n.jsx)(q.T,{}),onClick:()=>ej(es.token||""),children:"复制"})]})]})]})]})}),(0,n.jsxs)(R.j,{children:[(0,n.jsx)(x.$,{mr:3,onClick:ea,children:"关闭"}),(0,n.jsx)(x.$,{colorScheme:"blue",onClick:eh,isLoading:X,isDisabled:!Y,children:"创建令牌"})]})]})]}),(0,n.jsxs)(U.t,{children:[(0,n.jsxs)($.w,{children:[(0,n.jsx)(K.o,{children:"Windows 配置"}),(0,n.jsx)(K.o,{children:"macOS 配置"}),(0,n.jsx)(K.o,{children:"Linux 配置"}),(0,n.jsx)(K.o,{children:"第三方客户端"})]}),(0,n.jsxs)(N.T,{children:[(0,n.jsx)(Z.K,{children:(0,n.jsx)(m.Z,{children:(0,n.jsx)(p.b,{children:(0,n.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,n.jsx)(d.D,{size:"sm",children:"Windows 文件资源管理器配置"}),(0,n.jsx)(b.E,{children:"1. 打开文件资源管理器"}),(0,n.jsx)(b.E,{children:'2. 右键"此电脑" → "映射网络驱动器"'}),(0,n.jsx)(b.E,{children:"3. 选择驱动器号，输入地址（如：http://your-domain/webdav/bucket-name）"}),(0,n.jsx)(b.E,{children:"4. 输入您的用户名"}),(0,n.jsx)(b.E,{children:"5. 输入WebDAV访问令牌作为密码"}),(0,n.jsxs)(j.F,{status:"info",mt:4,children:[(0,n.jsx)(u._,{}),(0,n.jsxs)(a.a,{children:[(0,n.jsxs)(b.E,{fontSize:"sm",mb:2,children:[(0,n.jsx)("strong",{children:"认证方式："}),"可以使用用户名/令牌，或者直接使用 Token xxx 作为认证头"]}),(0,n.jsxs)(b.E,{fontSize:"xs",color:"blue.600",children:["\uD83D\uDCC4 更多 Windows 配置细节和故障排查，请查看",(0,n.jsx)(x.$,{as:"a",href:"https://github.com/myysophia/ossmanager/blob/main/docs/webdav-usage.md#windows-%E7%B3%BB%E7%BB%9F",target:"_blank",rel:"noopener noreferrer",size:"xs",variant:"link",colorScheme:"blue",ml:1,children:"完整指南"})]})]})]})]})})})}),(0,n.jsx)(Z.K,{children:(0,n.jsx)(m.Z,{children:(0,n.jsx)(p.b,{children:(0,n.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,n.jsx)(d.D,{size:"sm",children:"macOS Finder 配置"}),(0,n.jsx)(b.E,{children:"1. 打开 Finder"}),(0,n.jsx)(b.E,{children:'2. 按 Cmd+K 或菜单"前往" → "连接服务器"'}),(0,n.jsx)(b.E,{children:"3. 输入服务器地址（如：http://your-domain/webdav/bucket-name）"}),(0,n.jsx)(b.E,{children:"4. 输入您的用户名和WebDAV访问令牌"})]})})})}),(0,n.jsx)(Z.K,{children:(0,n.jsx)(m.Z,{children:(0,n.jsx)(p.b,{children:(0,n.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,n.jsx)(d.D,{size:"sm",children:"Linux 命令行配置"}),(0,n.jsx)(b.E,{children:"使用 davfs2："}),(0,n.jsx)(y.C,{children:"sudo mount -t davfs http://your-domain/webdav/bucket-name /mnt/webdav"}),(0,n.jsx)(b.E,{children:"或使用 cadaver："}),(0,n.jsx)(y.C,{children:"cadaver http://your-domain/webdav/bucket-name"}),(0,n.jsxs)(j.F,{status:"info",mt:4,children:[(0,n.jsx)(u._,{}),(0,n.jsx)(a.a,{children:(0,n.jsxs)(b.E,{fontSize:"sm",children:[(0,n.jsx)("strong",{children:"提示："}),"在连接时输入您的用户名和 WebDAV 访问令牌"]})})]})]})})})}),(0,n.jsx)(Z.K,{children:(0,n.jsx)(m.Z,{children:(0,n.jsx)(p.b,{children:(0,n.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,n.jsx)(d.D,{size:"sm",children:"推荐的第三方客户端"}),(0,n.jsx)(b.E,{children:"• WinSCP (Windows)"}),(0,n.jsx)(b.E,{children:"• Cyberduck (跨平台)"}),(0,n.jsx)(b.E,{children:"• FileZilla (跨平台)"}),(0,n.jsx)(b.E,{children:"• WebDAV Navigator (iOS/Android)"})]})})})})]})]})]})})}},79332:(e,s,r)=>{Promise.resolve().then(r.bind(r,34655))},96918:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});var n=r(23464),i=r(7161),t=r(49509);let l=n.A.create({baseURL:t.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let s=localStorage.getItem("token");s&&(e.headers.Authorization="Bearer ".concat(s))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),l.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let s=e.data;return s&&"object"==typeof s&&void 0!==s.code?0!==s.code&&200!==s.code?(console.error("API响应错误:",s),Promise.reject(Error(s.message||"请求失败"))):s:e},e=>{var s,r,n;return console.error("请求失败:",{url:null===(s=e.config)||void 0===s?void 0:s.url,message:e.message,response:null===(r=e.response)||void 0===r?void 0:r.data}),e.response?401===e.response.status?(0,i.Hl)():console.error("API错误:",(null===(n=e.response.data)||void 0===n?void 0:n.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let a=l}},e=>{var s=s=>e(e.s=s);e.O(0,[8791,6829,6980,7039,2210,3464,3513,6654,4415,5823,8441,1684,7358],()=>s(79332)),_N_E=e.O()}]);