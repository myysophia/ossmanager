(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9058],{7161:(e,s,n)=>{"use strict";n.d(s,{HY:()=>t,Hl:()=>r});let r=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},t=e=>{var s;return e&&"object"==typeof e&&"response"in e&&(null===(s=e.response)||void 0===s?void 0:s.status)===401}},11649:(e,s,n)=>{"use strict";n.d(s,{D:()=>o});var r=n(95155),t=n(78038),i=n(92622),a=n(30044),l=n(17891),c=n(47415);let o=(0,a.R)(function(e,s){let n=(0,l.V)("Heading",e),{className:a,...o}=(0,t.M)(e);return(0,r.jsx)(c.B.h2,{ref:s,className:(0,i.cx)("chakra-heading",e.className),...o,__css:n})});o.displayName="Heading"},32643:(e,s,n)=>{"use strict";n.d(s,{d:()=>t});var r=n(95155);let t=(0,n(24345).w)({displayName:"DeleteIcon",path:(0,r.jsx)("g",{fill:"currentColor",children:(0,r.jsx)("path",{d:"M19.452 7.5H4.547a.5.5 0 00-.5.545l1.287 14.136A2 2 0 007.326 24h9.347a2 2 0 001.992-1.819L19.95 8.045a.5.5 0 00-.129-.382.5.5 0 00-.369-.163zm-9.2 13a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zm5 0a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zM22 4h-4.75a.25.25 0 01-.25-.25V2.5A2.5 2.5 0 0014.5 0h-5A2.5 2.5 0 007 2.5v1.25a.25.25 0 01-.25.25H2a1 1 0 000 2h20a1 1 0 000-2zM9 3.75V2.5a.5.5 0 01.5-.5h5a.5.5 0 01.5.5v1.25a.25.25 0 01-.25.25h-5.5A.25.25 0 019 3.75z"})})})},72733:(e,s,n)=>{"use strict";n.d(s,{O:()=>t});var r=n(96918);let t={createToken:async e=>(await r.A.post("/webdav/token",e)).data.data,listTokens:async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new URLSearchParams;return e&&n.append("bucket",e),s&&n.append("include_expired","true"),(await r.A.get("/webdav/token?".concat(n.toString()))).data.data},deleteToken:async e=>{await r.A.delete("/webdav/token/".concat(e))},getConnectionInfo:async e=>(await r.A.get("/webdav/token/connection-info/".concat(e))).data.data,testConnection:async e=>(await r.A.get("/webdav/token/test/".concat(e))).data.data,getAccessibleBuckets:async()=>(await r.A.get("/oss/region-buckets/user-accessible")).data.data}},74132:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>Q});var r=n(95155),t=n(12115),i=n(52017),a=n(23006),l=n(77700),c=n(75569),o=n(59108),d=n(11649),h=n(92998),x=n(77978),j=n(79788),u=n(21688),m=n(58670),b=n(29826),g=n(22274),p=n(24369),v=n(37824),k=n(83382),w=n(47272),f=n(76122),C=n(66080),y=n(24710),T=n(42104),D=n(58727),E=n(99785),S=n(39376),A=n(80436),z=n(25442),_=n(64688),W=n(61549),V=n(27104),I=n(19782),L=n(5643),O=n(26418),B=n(79175),P=n(4316),N=n(23833),F=n(49174),R=n(6126),U=n(40988),$=n(96065),H=n(62833),K=n(93176),M=n(72733),Z=n(99539),J=n(74093),q=n(32643);function Q(){let[e,s]=(0,t.useState)([]),[n,Q]=(0,t.useState)([]),[X,G]=(0,t.useState)(!1),[Y,ee]=(0,t.useState)(""),[es,en]=(0,t.useState)(null),[er,et]=(0,t.useState)(24),{isOpen:ei,onOpen:ea,onClose:el}=(0,i.j)(),ec=(0,a.d)();(0,t.useEffect)(()=>{eo(),ed()},[]);let eo=async()=>{try{let e=await M.O.getAccessibleBuckets();s(e)}catch(e){ec({title:"加载存储桶失败",description:"无法获取可访问的存储桶列表",status:"error",duration:5e3,isClosable:!0})}},ed=async()=>{try{let e=await M.O.listTokens();Q(e)}catch(e){ec({title:"加载令牌失败",description:"无法获取WebDAV令牌列表",status:"error",duration:5e3,isClosable:!0})}},eh=async()=>{if(!Y){ec({title:"请选择存储桶",status:"warning",duration:3e3,isClosable:!0});return}G(!0);try{let e=await M.O.createToken({bucket:Y,expires_in:er});en(e),ed(),ec({title:"令牌创建成功",description:"请复制并保存令牌，它将不会再次显示",status:"success",duration:5e3,isClosable:!0})}catch(e){ec({title:"创建令牌失败",description:"无法创建WebDAV访问令牌",status:"error",duration:5e3,isClosable:!0})}finally{G(!1)}},ex=async e=>{if(confirm("确定要删除这个令牌吗？"))try{await M.O.deleteToken(e),ed(),ec({title:"令牌删除成功",status:"success",duration:3e3,isClosable:!0})}catch(e){ec({title:"删除令牌失败",status:"error",duration:5e3,isClosable:!0})}},ej=async e=>{try{await navigator.clipboard.writeText(e),ec({title:"已复制到剪贴板",status:"success",duration:2e3,isClosable:!0})}catch(e){ec({title:"复制失败",status:"error",duration:2e3,isClosable:!0})}},eu=e=>"".concat(window.location.origin,"/webdav/").concat(e),em=e=>new Date(e).toLocaleString(),eb=e=>new Date(e)<new Date;return(0,r.jsx)(l.a,{p:6,children:(0,r.jsxs)(c.T,{spacing:6,align:"stretch",children:[(0,r.jsxs)(o.s,{align:"center",children:[(0,r.jsx)(d.D,{size:"lg",children:"WebDAV 访问管理"}),(0,r.jsx)(h.h,{}),(0,r.jsx)(x.$,{as:"a",href:"https://github.com/myysophia/ossmanager/blob/main/docs/webdav-usage.md",target:"_blank",rel:"noopener noreferrer",leftIcon:(0,r.jsx)(Z.p,{}),variant:"outline",mr:3,children:"\uD83D\uDCC4 使用指南"}),(0,r.jsx)(x.$,{colorScheme:"blue",onClick:ea,children:"创建新令牌"})]}),(0,r.jsxs)(j.F,{status:"info",borderRadius:"lg",children:[(0,r.jsx)(u._,{}),(0,r.jsxs)(l.a,{children:[(0,r.jsx)(m.E,{fontWeight:"bold",mb:1,children:"需要帮助？"}),(0,r.jsx)(m.E,{fontSize:"sm",mb:2,children:"查看完整的 WebDAV 使用指南，包含详细的挂载示例、认证配置和常见问题解决方案。"}),(0,r.jsx)(x.$,{as:"a",href:"https://github.com/myysophia/ossmanager/blob/main/docs/webdav-usage.md",target:"_blank",rel:"noopener noreferrer",size:"sm",leftIcon:(0,r.jsx)(Z.p,{}),colorScheme:"blue",variant:"outline",children:"\uD83D\uDCD6 阅读完整指南"})]})]}),(0,r.jsxs)(b.Z,{children:[(0,r.jsx)(g.a,{children:(0,r.jsx)(d.D,{size:"md",children:"访问令牌列表"})}),(0,r.jsx)(p.b,{children:0===n.length?(0,r.jsx)(m.E,{color:"gray.500",textAlign:"center",py:8,children:"暂无WebDAV访问令牌"}):(0,r.jsxs)(v.X,{variant:"simple",children:[(0,r.jsx)(k.d,{children:(0,r.jsxs)(w.Tr,{children:[(0,r.jsx)(f.Th,{children:"存储桶"}),(0,r.jsx)(f.Th,{children:"WebDAV地址"}),(0,r.jsx)(f.Th,{children:"创建时间"}),(0,r.jsx)(f.Th,{children:"过期时间"}),(0,r.jsx)(f.Th,{children:"状态"}),(0,r.jsx)(f.Th,{children:"操作"})]})}),(0,r.jsx)(C.N,{children:n.map(e=>(0,r.jsxs)(w.Tr,{children:[(0,r.jsx)(y.Td,{children:(0,r.jsx)(T.C,{children:e.bucket})}),(0,r.jsx)(y.Td,{children:(0,r.jsxs)(D.z,{children:[(0,r.jsx)(T.C,{fontSize:"sm",children:eu(e.bucket)}),(0,r.jsx)(E.m,{label:"复制地址",children:(0,r.jsx)(S.K,{"aria-label":"Copy URL",icon:(0,r.jsx)(J.T,{}),size:"sm",variant:"ghost",onClick:()=>ej(eu(e.bucket))})})]})}),(0,r.jsx)(y.Td,{children:em(e.created_at)}),(0,r.jsx)(y.Td,{children:em(e.expires_at)}),(0,r.jsx)(y.Td,{children:(0,r.jsx)(A.E,{colorScheme:eb(e.expires_at)?"red":"green",children:eb(e.expires_at)?"已过期":"有效"})}),(0,r.jsx)(y.Td,{children:(0,r.jsx)(E.m,{label:"删除令牌",children:(0,r.jsx)(S.K,{"aria-label":"Delete token",icon:(0,r.jsx)(q.d,{}),size:"sm",colorScheme:"red",variant:"ghost",onClick:()=>ex(e.id)})})})]},e.id))})]})})]}),(0,r.jsxs)(z.aF,{isOpen:ei,onClose:el,size:"lg",children:[(0,r.jsx)(_.m,{}),(0,r.jsxs)(W.$,{children:[(0,r.jsx)(V.r,{children:"创建WebDAV访问令牌"}),(0,r.jsx)(I.s,{}),(0,r.jsx)(L.c,{children:(0,r.jsxs)(c.T,{spacing:4,children:[(0,r.jsxs)(O.MJ,{children:[(0,r.jsx)(B.l,{children:"存储桶"}),(0,r.jsx)(P.l,{placeholder:"选择存储桶",value:Y,onChange:e=>ee(e.target.value),children:e.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)(O.MJ,{children:[(0,r.jsx)(B.l,{children:"过期时间（小时）"}),(0,r.jsxs)(N.Q7,{value:er,onChange:(e,s)=>et(s||24),min:1,max:720,children:[(0,r.jsx)(N.OO,{}),(0,r.jsxs)(N.lw,{children:[(0,r.jsx)(N.Q0,{}),(0,r.jsx)(N.Sh,{})]})]}),(0,r.jsx)(m.E,{fontSize:"sm",color:"gray.500",mt:1,children:"最大720小时（30天）"})]}),es&&(0,r.jsxs)(j.F,{status:"success",children:[(0,r.jsx)(u._,{}),(0,r.jsxs)(l.a,{children:[(0,r.jsx)(m.E,{fontWeight:"bold",mb:2,children:"令牌创建成功！"}),(0,r.jsx)(m.E,{fontSize:"sm",mb:2,children:"请复制并保存以下令牌，它将不会再次显示："}),(0,r.jsxs)(D.z,{children:[(0,r.jsx)(T.C,{p:2,fontSize:"sm",wordBreak:"break-all",children:es.token}),(0,r.jsx)(x.$,{size:"sm",leftIcon:(0,r.jsx)(J.T,{}),onClick:()=>ej(es.token||""),children:"复制"})]})]})]})]})}),(0,r.jsxs)(F.j,{children:[(0,r.jsx)(x.$,{mr:3,onClick:el,children:"关闭"}),(0,r.jsx)(x.$,{colorScheme:"blue",onClick:eh,isLoading:X,isDisabled:!Y,children:"创建令牌"})]})]})]}),(0,r.jsxs)(R.t,{children:[(0,r.jsxs)(U.w,{children:[(0,r.jsx)($.o,{children:"Windows 配置"}),(0,r.jsx)($.o,{children:"macOS 配置"}),(0,r.jsx)($.o,{children:"Linux 配置"}),(0,r.jsx)($.o,{children:"第三方客户端"})]}),(0,r.jsxs)(H.T,{children:[(0,r.jsx)(K.K,{children:(0,r.jsx)(b.Z,{children:(0,r.jsx)(p.b,{children:(0,r.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,r.jsx)(d.D,{size:"sm",children:"Windows 文件资源管理器配置"}),(0,r.jsx)(m.E,{children:"1. 打开文件资源管理器"}),(0,r.jsx)(m.E,{children:'2. 右键"此电脑" → "映射网络驱动器"'}),(0,r.jsx)(m.E,{children:"3. 选择驱动器号，输入地址（如：http://your-domain/webdav/bucket-name）"}),(0,r.jsx)(m.E,{children:"4. 输入您的用户名"}),(0,r.jsx)(m.E,{children:"5. 输入WebDAV访问令牌作为密码"}),(0,r.jsxs)(j.F,{status:"info",mt:4,children:[(0,r.jsx)(u._,{}),(0,r.jsxs)(l.a,{children:[(0,r.jsxs)(m.E,{fontSize:"sm",mb:2,children:[(0,r.jsx)("strong",{children:"认证方式："}),"可以使用用户名/令牌，或者直接使用 Token xxx 作为认证头"]}),(0,r.jsxs)(m.E,{fontSize:"xs",color:"blue.600",children:["\uD83D\uDCC4 更多 Windows 配置细节和故障排查，请查看",(0,r.jsx)(x.$,{as:"a",href:"https://github.com/myysophia/ossmanager/blob/main/docs/webdav-usage.md#windows-%E7%B3%BB%E7%BB%9F",target:"_blank",rel:"noopener noreferrer",size:"xs",variant:"link",colorScheme:"blue",ml:1,children:"完整指南"})]})]})]})]})})})}),(0,r.jsx)(K.K,{children:(0,r.jsx)(b.Z,{children:(0,r.jsx)(p.b,{children:(0,r.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,r.jsx)(d.D,{size:"sm",children:"macOS Finder 配置"}),(0,r.jsx)(m.E,{children:"1. 打开 Finder"}),(0,r.jsx)(m.E,{children:'2. 按 Cmd+K 或菜单"前往" → "连接服务器"'}),(0,r.jsx)(m.E,{children:"3. 输入服务器地址（如：http://your-domain/webdav/bucket-name）"}),(0,r.jsx)(m.E,{children:"4. 输入您的用户名和WebDAV访问令牌"})]})})})}),(0,r.jsx)(K.K,{children:(0,r.jsx)(b.Z,{children:(0,r.jsx)(p.b,{children:(0,r.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,r.jsx)(d.D,{size:"sm",children:"Linux 命令行配置"}),(0,r.jsx)(m.E,{children:"使用 davfs2："}),(0,r.jsx)(T.C,{children:"sudo mount -t davfs http://your-domain/webdav/bucket-name /mnt/webdav"}),(0,r.jsx)(m.E,{children:"或使用 cadaver："}),(0,r.jsx)(T.C,{children:"cadaver http://your-domain/webdav/bucket-name"}),(0,r.jsxs)(j.F,{status:"info",mt:4,children:[(0,r.jsx)(u._,{}),(0,r.jsx)(l.a,{children:(0,r.jsxs)(m.E,{fontSize:"sm",children:[(0,r.jsx)("strong",{children:"提示："}),"在连接时输入您的用户名和 WebDAV 访问令牌"]})})]})]})})})}),(0,r.jsx)(K.K,{children:(0,r.jsx)(b.Z,{children:(0,r.jsx)(p.b,{children:(0,r.jsxs)(c.T,{align:"stretch",spacing:4,children:[(0,r.jsx)(d.D,{size:"sm",children:"推荐的第三方客户端"}),(0,r.jsx)(m.E,{children:"• WinSCP (Windows)"}),(0,r.jsx)(m.E,{children:"• Cyberduck (跨平台)"}),(0,r.jsx)(m.E,{children:"• FileZilla (跨平台)"}),(0,r.jsx)(m.E,{children:"• WebDAV Navigator (iOS/Android)"})]})})})})]})]})]})})}},79332:(e,s,n)=>{Promise.resolve().then(n.bind(n,74132))},96918:(e,s,n)=>{"use strict";n.d(s,{A:()=>l});var r=n(23464),t=n(7161),i=n(87358);let a=r.A.create({baseURL:i.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let s=localStorage.getItem("token");s&&(e.headers.Authorization="Bearer ".concat(s))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),a.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let s=e.data;return s&&"object"==typeof s&&void 0!==s.code?0!==s.code&&200!==s.code?(console.error("API响应错误:",s),Promise.reject(Error(s.message||"请求失败"))):s:e},e=>{var s,n,r;return console.error("请求失败:",{url:null===(s=e.config)||void 0===s?void 0:s.url,message:e.message,response:null===(n=e.response)||void 0===n?void 0:n.data}),e.response?401===e.response.status?(0,t.Hl)():console.error("API错误:",(null===(r=e.response.data)||void 0===r?void 0:r.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let l=a}},e=>{var s=s=>e(e.s=s);e.O(0,[8791,6829,6980,7039,2210,3464,3513,6654,4415,2714,8968,8441,1684,7358],()=>s(79332)),_N_E=e.O()}]);