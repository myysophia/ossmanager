(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689],{7161:(e,s,t)=>{"use strict";t.d(s,{HY:()=>a,Hl:()=>i});let i=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},a=e=>{var s;return e&&"object"==typeof e&&"response"in e&&(null===(s=e.response)||void 0===s?void 0:s.status)===401}},21118:(e,s,t)=>{"use strict";t.d(s,{x:()=>r});var i=t(95155),a=t(30044),n=t(47415);let r=(0,a.R)(function(e,s){let{templateAreas:t,gap:a,rowGap:r,columnGap:l,column:c,row:o,autoFlow:d,autoRows:h,templateRows:x,autoColumns:u,templateColumns:j,...m}=e;return(0,i.jsx)(n.B.div,{ref:s,__css:{display:"grid",gridTemplateAreas:t,gridGap:a,gridRowGap:r,gridColumnGap:l,gridAutoColumns:u,gridColumn:c,gridRow:o,gridAutoFlow:d,gridAutoRows:h,gridTemplateRows:x,gridTemplateColumns:j},...m})});r.displayName="Grid"},22531:(e,s,t)=>{Promise.resolve().then(t.bind(t,24805))},24805:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ea});var i=t(95155),a=t(12115),n=t(23006),r=t(77700),l=t(75569),c=t(84492),o=t(58670),d=t(59108),h=t(58727),x=t(11649),u=t(92998),j=t(99785),m=t(39376),p=t(29826),g=t(22274),b=t(24369),f=t(79788),w=t(21688),z=t(4316),S=t(80436),y=t(43508),k=t(6126),v=t(40988),C=t(96065),A=t(62833),E=t(93176),D=t(21118),T=t(50765),_=t(85720),W=t(30044),R=t(47415);function F(e){return(0,T.bk)(e,e=>"auto"===e?"auto":"span ".concat(e,"/span ").concat(e))}let V=(0,W.R)(function(e,s){let{area:t,colSpan:a,colStart:n,colEnd:r,rowEnd:l,rowSpan:c,rowStart:o,...d}=e,h=(0,_.o)({gridArea:t,gridColumn:F(a),gridRow:F(c),gridColumnStart:n,gridColumnEnd:r,gridRowStart:o,gridRowEnd:l});return(0,i.jsx)(R.B.div,{ref:s,__css:h,...d})});V.displayName="GridItem";var L=t(72733),U=t(10351),P=t(52017),I=t(26418),O=t(79175),B=t(42104),H=t(25442),M=t(64688),K=t(61549),N=t(27104),J=t(19782),$=t(5643),G=t(23833),Z=t(77978),q=t(49174),Q=t(91985),X=t(74093),Y=t(99539);function ee(e){let{selectedBucket:s,onTokenSelect:t,showWebDAVUrl:y=!0,showCreateOption:k=!0,size:v="md"}=e,[C,A]=(0,a.useState)([]),[E,D]=(0,a.useState)(null),[T,_]=(0,a.useState)(!1),[W,R]=(0,a.useState)(!1),[F,V]=(0,a.useState)(null),[U,ee]=(0,a.useState)(24),{isOpen:es,onOpen:et,onClose:ei}=(0,P.j)(),ea=(0,n.d)();(0,a.useEffect)(()=>{s?en():(A([]),D(null))},[s]),(0,a.useEffect)(()=>{let e=C.find(e=>e.id===E)||null;t&&t(e)},[E,C,t]);let en=async()=>{_(!0);try{let e=await L.O.listTokens(s,!1);if(A(e),e.length>0&&!E){let s=e.find(e=>!ec(e.expires_at));s&&D(s.id)}}catch(e){console.error("Load tokens error:",e),ea({title:"加载令牌失败",description:"无法获取WebDAV令牌列表",status:"error",duration:3e3,isClosable:!0})}finally{_(!1)}},er=async()=>{if(s){R(!0);try{let e=await L.O.createToken({bucket:s,expires_in:U});V(e),await en(),D(e.id),ea({title:"令牌创建成功",description:"新的WebDAV访问令牌已创建",status:"success",duration:3e3,isClosable:!0})}catch(e){console.error("Create token error:",e),ea({title:"创建令牌失败",description:"无法创建WebDAV访问令牌",status:"error",duration:3e3,isClosable:!0})}finally{R(!1)}}},el=async e=>{try{await navigator.clipboard.writeText(e),ea({title:"已复制到剪贴板",status:"success",duration:2e3,isClosable:!0})}catch(e){ea({title:"复制失败",status:"error",duration:2e3,isClosable:!0})}},ec=e=>new Date(e)<new Date,eo=e=>new Date(e).toLocaleString(),ed=C.find(e=>e.id===E),eh=s?"".concat(window.location.origin,"/webdav/").concat(s):"";return s?(0,i.jsxs)(p.Z,{size:v,children:[(0,i.jsx)(g.a,{pb:2,children:(0,i.jsxs)(d.s,{align:"center",children:[(0,i.jsx)(x.D,{size:"sm",children:"WebDAV 访问配置"}),(0,i.jsx)(u.h,{}),k&&(0,i.jsx)(j.m,{label:"创建新令牌",children:(0,i.jsx)(m.K,{"aria-label":"创建新令牌",icon:(0,i.jsx)(Q.R,{}),size:"sm",variant:"outline",onClick:et,isDisabled:!s})})]})}),(0,i.jsx)(b.b,{pt:0,children:(0,i.jsxs)(l.T,{spacing:4,align:"stretch",children:[(0,i.jsxs)(I.MJ,{children:[(0,i.jsx)(O.l,{fontSize:"sm",children:"访问令牌"}),T?(0,i.jsxs)(h.z,{children:[(0,i.jsx)(c.y,{size:"sm"}),(0,i.jsx)(o.E,{fontSize:"sm",children:"加载令牌..."})]}):0===C.length?(0,i.jsxs)(f.F,{status:"warning",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(o.E,{fontSize:"sm",children:["该存储桶暂无可用的访问令牌",k&&"，请创建一个新令牌"]})]}):(0,i.jsx)(z.l,{size:"sm",placeholder:"选择访问令牌",value:E||"",onChange:e=>D(e.target.value?parseInt(e.target.value):null),children:C.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.bucket," - ",ec(e.expires_at)?"已过期":"有效"," (到期: ",eo(e.expires_at),")"]},e.id))})]}),ed&&(0,i.jsxs)(r.a,{children:[(0,i.jsxs)(h.z,{mb:2,children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:"令牌状态:"}),(0,i.jsx)(S.E,{colorScheme:ec(ed.expires_at)?"red":"green",children:ec(ed.expires_at)?"已过期":"有效"})]}),(0,i.jsxs)(o.E,{fontSize:"xs",color:"gray.600",children:["创建时间: ",eo(ed.created_at)]}),(0,i.jsxs)(o.E,{fontSize:"xs",color:"gray.600",children:["过期时间: ",eo(ed.expires_at)]})]}),y&&(0,i.jsxs)(I.MJ,{children:[(0,i.jsx)(O.l,{fontSize:"sm",children:"WebDAV 地址"}),(0,i.jsxs)(h.z,{children:[(0,i.jsx)(B.C,{fontSize:"sm",p:2,borderRadius:"md",bg:"gray.50",flex:1,children:eh}),(0,i.jsx)(j.m,{label:"复制地址",children:(0,i.jsx)(m.K,{"aria-label":"复制WebDAV地址",icon:(0,i.jsx)(X.T,{}),size:"sm",variant:"ghost",onClick:()=>el(eh)})}),(0,i.jsx)(j.m,{label:"在外部WebDAV客户端中打开",children:(0,i.jsx)(m.K,{"aria-label":"打开WebDAV",icon:(0,i.jsx)(Y.p,{}),size:"sm",variant:"ghost",onClick:()=>window.open(eh,"_blank")})})]}),(0,i.jsx)(o.E,{fontSize:"xs",color:"gray.600",mt:1,children:"复制此地址到您的操作系统文件管理器或WebDAV客户端中挂载"})]}),(0,i.jsxs)(f.F,{status:"info",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(l.T,{align:"start",spacing:1,children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:"使用说明"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"• 浏览器内使用代理API无需令牌（自动JWT认证）"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"• 外部客户端需要令牌进行身份验证"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"• 用户名: 您的登录用户名，密码: 访问令牌"})]})]})]})}),(0,i.jsxs)(H.aF,{isOpen:es,onClose:()=>{ei(),V(null)},size:"lg",children:[(0,i.jsx)(M.m,{}),(0,i.jsxs)(K.$,{children:[(0,i.jsx)(N.r,{children:"创建WebDAV访问令牌"}),(0,i.jsx)(J.s,{}),(0,i.jsx)($.c,{children:(0,i.jsxs)(l.T,{spacing:4,children:[(0,i.jsxs)(f.F,{status:"info",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(o.E,{fontSize:"sm",children:["为存储桶 ",(0,i.jsx)(B.C,{children:s})," 创建新的访问令牌"]})]}),(0,i.jsxs)(I.MJ,{children:[(0,i.jsx)(O.l,{children:"过期时间（小时）"}),(0,i.jsxs)(G.Q7,{value:U,onChange:(e,s)=>ee(s||24),min:1,max:720,children:[(0,i.jsx)(G.OO,{}),(0,i.jsxs)(G.lw,{children:[(0,i.jsx)(G.Q0,{}),(0,i.jsx)(G.Sh,{})]})]}),(0,i.jsx)(o.E,{fontSize:"sm",color:"gray.500",mt:1,children:"最大720小时（30天）"})]}),F&&(0,i.jsxs)(f.F,{status:"success",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(r.a,{children:[(0,i.jsx)(o.E,{fontWeight:"bold",mb:2,children:"令牌创建成功！"}),(0,i.jsx)(o.E,{fontSize:"sm",mb:2,children:"请复制并保存以下令牌，它将不会再次显示："}),(0,i.jsxs)(h.z,{children:[(0,i.jsx)(B.C,{p:2,fontSize:"sm",wordBreak:"break-all",flex:1,children:F.token}),(0,i.jsx)(Z.$,{size:"sm",leftIcon:(0,i.jsx)(X.T,{}),onClick:()=>el(F.token||""),children:"复制"})]})]})]})]})}),(0,i.jsxs)(q.j,{children:[(0,i.jsx)(Z.$,{mr:3,onClick:()=>{ei(),V(null)},children:"关闭"}),(0,i.jsx)(Z.$,{colorScheme:"blue",onClick:er,isLoading:W,isDisabled:!s||!!F,children:"创建令牌"})]})]})]})]}):(0,i.jsxs)(f.F,{status:"info",children:[(0,i.jsx)(w._,{}),(0,i.jsx)(o.E,{children:"请先选择存储桶"})]})}function es(e){let{selectedBucket:s,selectedToken:t,size:a="md",showInstructions:c=!0}=e,z=(0,n.d)(),S=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"内容";try{await navigator.clipboard.writeText(e),z({title:"".concat(s,"已复制到剪贴板"),status:"success",duration:2e3,isClosable:!0})}catch(e){z({title:"复制失败",status:"error",duration:2e3,isClosable:!0})}},y=e=>"".concat(window.location.origin,"/webdav/").concat(e),k=()=>{let e=y(s);window.open(e,"_blank")};if(!s)return(0,i.jsxs)(f.F,{status:"info",size:a,children:[(0,i.jsx)(w._,{}),(0,i.jsx)(o.E,{fontSize:"sm"===a?"sm":"md",children:"请先选择存储桶"})]});let v=y(s),C=!!t&&new Date(t.expires_at)<new Date;return(0,i.jsxs)(p.Z,{size:a,children:[(0,i.jsx)(g.a,{pb:2,children:(0,i.jsxs)(d.s,{align:"center",children:[(0,i.jsxs)(h.z,{children:[(0,i.jsx)(Y.p,{}),(0,i.jsx)(x.D,{size:"sm",children:"外部WebDAV客户端"})]}),(0,i.jsx)(u.h,{}),(0,i.jsx)(j.m,{label:"在外部客户端中打开",children:(0,i.jsx)(m.K,{"aria-label":"打开WebDAV",icon:(0,i.jsx)(Y.p,{}),size:"sm",variant:"outline",onClick:k,isDisabled:!s})})]})}),(0,i.jsx)(b.b,{pt:0,children:(0,i.jsxs)(l.T,{spacing:4,align:"stretch",children:[(0,i.jsxs)(r.a,{children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"WebDAV 地址:"}),(0,i.jsxs)(h.z,{children:[(0,i.jsx)(B.C,{fontSize:"sm",p:2,borderRadius:"md",bg:"gray.50",flex:1,wordBreak:"break-all",children:v}),(0,i.jsx)(j.m,{label:"复制地址",children:(0,i.jsx)(m.K,{"aria-label":"复制WebDAV地址",icon:(0,i.jsx)(X.T,{}),size:"sm",variant:"ghost",onClick:()=>S(v,"WebDAV地址")})})]})]}),t?(0,i.jsxs)(f.F,{status:C?"error":"success",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(l.T,{align:"start",spacing:1,children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:C?"令牌已过期":"令牌可用"}),!C&&(0,i.jsxs)(o.E,{fontSize:"xs",children:["令牌到期时间: ",new Date(t.expires_at).toLocaleString()]}),C&&(0,i.jsx)(o.E,{fontSize:"xs",children:"请创建新的访问令牌以继续使用外部客户端"})]})]}):(0,i.jsxs)(f.F,{status:"warning",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(l.T,{align:"start",spacing:1,children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:"未选择访问令牌"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"外部WebDAV客户端需要访问令牌进行身份验证"})]})]}),(0,i.jsxs)(l.T,{spacing:2,align:"stretch",children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:"快速操作:"}),(0,i.jsxs)(h.z,{children:[(0,i.jsx)(Z.$,{size:"sm",leftIcon:(0,i.jsx)(X.T,{}),variant:"outline",onClick:()=>S(v,"WebDAV地址"),children:"复制地址"}),t&&!C&&(0,i.jsx)(Z.$,{size:"sm",leftIcon:(0,i.jsx)(X.T,{}),variant:"outline",onClick:()=>S(t.token||"","访问令牌"),children:"复制令牌"}),(0,i.jsx)(Z.$,{size:"sm",leftIcon:(0,i.jsx)(Y.p,{}),colorScheme:"blue",variant:"outline",onClick:k,children:"打开客户端"})]})]}),c&&(0,i.jsxs)(f.F,{status:"info",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(l.T,{align:"start",spacing:1,children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:"使用外部客户端:"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"1. 复制上方WebDAV地址到您的文件管理器"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"2. 输入用户名和访问令牌进行认证"}),(0,i.jsx)(o.E,{fontSize:"xs",children:"3. 支持: Windows资源管理器、macOS Finder、第三方工具"})]})]})]})})]})}var et=t(59881),ei=t(40615);function ea(){let[e,s]=(0,a.useState)([]),[t,T]=(0,a.useState)(""),[_,W]=(0,a.useState)(null),[R,F]=(0,a.useState)(!0),[P,I]=(0,a.useState)(!1),[O,B]=(0,a.useState)("/"),[H,M]=(0,a.useState)([]),[K,N]=(0,a.useState)([]),[J,$]=(0,a.useState)([]),[G,Z]=(0,a.useState)(!1),[q,Q]=(0,a.useState)(!1),[X,Y]=(0,a.useState)("files"),ea=(0,n.d)();(0,a.useEffect)(()=>{en()},[]),(0,a.useEffect)(()=>{t&&eo(O)},[t]),(0,a.useEffect)(()=>{ed(O)},[O]);let en=async()=>{try{F(!0);let e=await L.O.getAccessibleBuckets();s(e),e.length>0&&!t&&T(e[0])}catch(e){console.error("Load buckets error:",e),ea({title:"加载存储桶失败",description:"无法获取可访问的存储桶列表",status:"error",duration:5e3,isClosable:!0})}finally{F(!1)}},er=async()=>{I(!0),await en(),I(!1)},el=e=>"".concat(window.location.origin,"/webdav/").concat(e),ec=e=>{let s=el(e);window.open(s,"_blank")},eo=(0,a.useCallback)(async e=>{if(t)try{Z(!0);let s=(await ei.A7.listObjects(t,e)).items.map(e=>({id:e.path,name:e.name,type:e.isDir?"folder":"file",size:e.size,lastModified:new Date(e.mtime),path:e.path,permissions:["read","write","delete"]}));M(s)}catch(e){console.error("Load files error:",e),ea({title:"加载文件失败",description:"无法获取文件列表",status:"error",duration:3e3,isClosable:!0})}finally{Z(!1)}},[t,ea]),ed=(0,a.useCallback)(e=>{let s=e.split("/").filter(Boolean),t=[{label:"根目录",path:"/"}],i="";s.forEach(e=>{i+="/"+e,t.push({label:e,path:i})}),N(t)},[]),eh=(0,a.useCallback)(async e=>{B(e),await eo(e)},[eo]);return R?(0,i.jsx)(r.a,{p:6,children:(0,i.jsxs)(l.T,{spacing:4,children:[(0,i.jsx)(c.y,{size:"lg"}),(0,i.jsx)(o.E,{children:"加载存储桶列表..."})]})}):(0,i.jsx)(r.a,{p:6,children:(0,i.jsxs)(l.T,{spacing:6,align:"stretch",children:[(0,i.jsxs)(d.s,{align:"center",children:[(0,i.jsxs)(h.z,{spacing:3,children:[(0,i.jsx)(r.a,{bg:"blue.500",p:2,borderRadius:"md",color:"white",children:(0,i.jsx)(U.UDU,{size:20})}),(0,i.jsx)(x.D,{size:"lg",children:"WebDAV 浏览器"})]}),(0,i.jsx)(u.h,{}),(0,i.jsx)(j.m,{label:"刷新存储桶列表",children:(0,i.jsx)(m.K,{"aria-label":"刷新",icon:(0,i.jsx)(U.jTZ,{}),variant:"outline",isLoading:P,onClick:er})})]}),(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(g.a,{children:(0,i.jsx)(x.D,{size:"md",children:(0,i.jsxs)(h.z,{children:[(0,i.jsx)(U.Jqy,{}),(0,i.jsx)(o.E,{children:"存储桶选择"})]})})}),(0,i.jsx)(b.b,{children:0===e.length?(0,i.jsxs)(f.F,{status:"warning",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(l.T,{align:"start",spacing:2,children:[(0,i.jsx)(o.E,{children:"暂无可访问的存储桶"}),(0,i.jsx)(o.E,{fontSize:"sm",color:"gray.600",children:"请联系管理员为您分配存储桶访问权限"})]})]}):(0,i.jsxs)(l.T,{spacing:4,align:"stretch",children:[(0,i.jsxs)(h.z,{children:[(0,i.jsx)(o.E,{fontSize:"sm",color:"gray.600",minW:"80px",children:"当前存储桶:"}),(0,i.jsx)(z.l,{value:t,onChange:e=>T(e.target.value),placeholder:"请选择存储桶",children:e.map(e=>(0,i.jsx)("option",{value:e,children:e},e))}),(0,i.jsxs)(S.E,{colorScheme:"blue",fontSize:"xs",children:["共 ",e.length," 个"]})]}),t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.c,{}),(0,i.jsxs)(l.T,{spacing:3,align:"stretch",children:[(0,i.jsx)(o.E,{fontSize:"sm",fontWeight:"medium",children:"WebDAV 连接信息:"}),(0,i.jsx)(r.a,{bg:"gray.50",p:3,borderRadius:"md",border:"1px solid",borderColor:"gray.200",children:(0,i.jsxs)(l.T,{spacing:2,align:"stretch",children:[(0,i.jsxs)(h.z,{children:[(0,i.jsx)(o.E,{fontSize:"sm",color:"gray.600",minW:"60px",children:"URL:"}),(0,i.jsx)(o.E,{fontSize:"sm",fontFamily:"mono",flex:1,children:el(t)}),(0,i.jsx)(j.m,{label:"在新窗口中打开",children:(0,i.jsx)(m.K,{"aria-label":"打开WebDAV",icon:(0,i.jsx)(U.HaR,{}),size:"xs",variant:"ghost",onClick:()=>ec(t)})})]}),(0,i.jsxs)(h.z,{children:[(0,i.jsx)(o.E,{fontSize:"sm",color:"gray.600",minW:"60px",children:"存储桶:"}),(0,i.jsx)(o.E,{fontSize:"sm",fontFamily:"mono",flex:1,children:t})]})]})})]})]})]})})]}),t&&(0,i.jsx)(p.Z,{children:(0,i.jsx)(b.b,{p:0,children:(0,i.jsxs)(k.t,{index:+("files"!==X),onChange:e=>Y(0===e?"files":"settings"),isFitted:!0,variant:"enclosed",children:[(0,i.jsxs)(v.w,{children:[(0,i.jsx)(C.o,{children:(0,i.jsxs)(h.z,{spacing:2,children:[(0,i.jsx)(U.QuH,{}),(0,i.jsx)(o.E,{children:"文件浏览"})]})}),(0,i.jsx)(C.o,{children:(0,i.jsxs)(h.z,{spacing:2,children:[(0,i.jsx)(U.VSk,{}),(0,i.jsx)(o.E,{children:"连接设置"})]})})]}),(0,i.jsxs)(A.T,{children:[(0,i.jsx)(E.K,{p:0,children:(0,i.jsx)(r.a,{minH:"600px",children:(0,i.jsx)(et.Ih,{currentPath:O,items:H,breadcrumbs:K,uploads:J,isLoading:G,isRefreshing:q,viewMode:"list",actions:{onFolderDoubleClick:async e=>{await eh(e.path)},onFileDoubleClick:async e=>{try{let s="/api/v1/webdav/objects/".concat(t,"?path=").concat(encodeURIComponent(e.path));window.open(s,"_blank")}catch(e){ea({title:"下载失败",description:"无法下载文件",status:"error",duration:3e3,isClosable:!0})}},onUpload:async(e,s)=>{let i=e.map(async e=>{let i="/"===s?e.name:"".concat(s,"/").concat(e.name);try{await ei.A7.uploadFile(t,i,e,{onProgress:s=>{$(t=>t.find(s=>s.id===e.name)?t.map(t=>t.id===e.name?{...t,progress:s}:t):[...t,{id:e.name,filename:e.name,progress:s,status:"uploading",size:e.size}])}}),$(s=>s.map(s=>s.id===e.name?{...s,status:"completed",progress:100}:s)),ea({title:"上传成功",description:"文件 ".concat(e.name," 上传完成"),status:"success",duration:3e3,isClosable:!0})}catch(s){$(s=>s.map(s=>s.id===e.name?{...s,status:"failed"}:s)),ea({title:"上传失败",description:"文件 ".concat(e.name," 上传失败"),status:"error",duration:3e3,isClosable:!0})}});await Promise.all(i),await eo(O)},onDelete:async e=>{try{for(let s of e)await ei.A7.deleteObject(t,s.path);ea({title:"删除成功",description:"已删除 ".concat(e.length," 个项目"),status:"success",duration:3e3,isClosable:!0}),await eo(O)}catch(e){ea({title:"删除失败",description:"删除操作失败",status:"error",duration:3e3,isClosable:!0})}},onRename:async(e,s)=>{try{let i=e.path.replace(e.name,s);await ei.A7.renameObject(t,e.path,i),ea({title:"重命名成功",description:"已重命名为 ".concat(s),status:"success",duration:3e3,isClosable:!0}),await eo(O)}catch(e){ea({title:"重命名失败",description:"重命名操作失败",status:"error",duration:3e3,isClosable:!0})}},onCreateFolder:async(e,s)=>{try{let i="/"===s?"/".concat(e):"".concat(s,"/").concat(e);await ei.A7.createFolder(t,i),ea({title:"创建成功",description:"文件夹 ".concat(e," 创建完成"),status:"success",duration:3e3,isClosable:!0}),await eo(O)}catch(e){ea({title:"创建失败",description:"文件夹创建失败",status:"error",duration:3e3,isClosable:!0})}},onRefresh:async()=>{Q(!0),await eo(O),Q(!1)},onBreadcrumbClick:eh},config:{allowMultiSelect:!0,showHiddenFiles:!1,maxFileSize:0x6400000,maxConcurrentUploads:5,enableDragAndDrop:!0,enableContextMenu:!0}})})}),(0,i.jsx)(E.K,{p:6,children:(0,i.jsxs)(l.T,{spacing:6,align:"stretch",children:[(0,i.jsxs)(D.x,{templateColumns:{base:"1fr",lg:"1fr 1fr"},gap:6,children:[(0,i.jsx)(V,{children:(0,i.jsx)(ee,{selectedBucket:t,onTokenSelect:W,showWebDAVUrl:!1,size:"md"})}),(0,i.jsx)(V,{children:(0,i.jsx)(es,{selectedBucket:t,selectedToken:_,size:"md",showInstructions:!0})})]}),(0,i.jsxs)(l.T,{spacing:3,align:"stretch",children:[(0,i.jsxs)(f.F,{status:"info",children:[(0,i.jsx)(w._,{}),(0,i.jsxs)(l.T,{align:"start",spacing:1,children:[(0,i.jsx)(o.E,{fontWeight:"medium",children:"WebDAV 浏览器功能"}),(0,i.jsx)(o.E,{fontSize:"sm",children:"• 浏览器内访问: 使用代理API，无需令牌 (自动JWT认证)"}),(0,i.jsx)(o.E,{fontSize:"sm",children:"• 外部客户端: 需要访问令牌进行身份验证"}),(0,i.jsx)(o.E,{fontSize:"sm",children:"• 支持完整WebDAV操作: 浏览、上传、下载、创建文件夹等"})]})]}),t&&_&&(0,i.jsxs)(f.F,{status:"success",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsx)(o.E,{fontSize:"sm",children:"✅ 当前配置完整，可以通过浏览器或外部客户端访问存储桶"})]}),t&&!_&&(0,i.jsxs)(f.F,{status:"warning",size:"sm",children:[(0,i.jsx)(w._,{}),(0,i.jsx)(o.E,{fontSize:"sm",children:"⚠️ 浏览器访问正常，但外部客户端需要访问令牌"})]})]})]})})]})]})})})]})})}},40615:(e,s,t)=>{"use strict";t.d(s,{A7:()=>l});var i=t(23464),a=t(96918);class n{getAuthHeaders(){let e={};{let s=localStorage.getItem("token");s&&(e.Authorization="Bearer ".concat(s))}return e}async listObjects(e){try{let s=new URLSearchParams;e.path&&"/"!==e.path&&s.append("path",e.path);let t="".concat(this.baseURL,"/").concat(e.bucket).concat(s.toString()?"?".concat(s.toString()):""),i=await a.A.get(t);return i.data||i}catch(e){throw console.error("列出对象失败:",e),e}}async uploadFile(e){try{let s=new URLSearchParams;s.append("path",e.path);let t="".concat(this.baseURL,"/").concat(e.bucket,"/file?").concat(s.toString()),n=i.A.create({baseURL:a.A.defaults.baseURL,timeout:a.A.defaults.timeout,headers:{...this.getAuthHeaders(),"Content-Type":"application/octet-stream"}}),r=(await n.post(t,e.file,{onUploadProgress:e.onProgress,headers:{...this.getAuthHeaders(),"Content-Type":"application/octet-stream"}})).data;if(r&&"object"==typeof r&&void 0!==r.code){if(0!==r.code&&200!==r.code)throw Error(r.message||"上传失败");r=r.data}return r||{success:!0,message:"文件上传成功",path:e.path}}catch(e){throw console.error("文件上传失败:",e),e}}async deleteObject(e){try{let s=new URLSearchParams;s.append("path",e.path);let t="".concat(this.baseURL,"/").concat(e.bucket,"?").concat(s.toString()),i=await a.A.delete(t);return i.data||i}catch(e){throw console.error("删除对象失败:",e),e}}async renameObject(e){try{let s="".concat(this.baseURL,"/").concat(e.bucket,"/rename"),t={oldPath:e.oldPath,newPath:e.newPath},i=await a.A.patch(s,t);return i.data||i}catch(e){throw console.error("重命名对象失败:",e),e}}async createFolder(e){try{let s="".concat(this.baseURL,"/").concat(e.bucket,"/mkdir"),t={path:e.path},i=await a.A.post(s,t);return i.data||i}catch(e){throw console.error("创建文件夹失败:",e),e}}constructor(){this.baseURL="/webdav/objects"}}let r=new n,l={listObjects:(e,s)=>r.listObjects({bucket:e,path:s}),uploadFile:(e,s,t,i)=>r.uploadFile({bucket:e,path:s,file:t,onProgress:i}),deleteObject:(e,s)=>r.deleteObject({bucket:e,path:s}),renameObject:(e,s,t)=>r.renameObject({bucket:e,oldPath:s,newPath:t}),createFolder:(e,s)=>r.createFolder({bucket:e,path:s})}},43508:(e,s,t)=>{"use strict";t.d(s,{c:()=>o});var i=t(95155),a=t(78038),n=t(92622),r=t(30044),l=t(17891),c=t(47415);let o=(0,r.R)(function(e,s){let{borderLeftWidth:t,borderBottomWidth:r,borderTopWidth:o,borderRightWidth:d,borderWidth:h,borderStyle:x,borderColor:u,...j}=(0,l.V)("Divider",e),{className:m,orientation:p="horizontal",__css:g,...b}=(0,a.M)(e);return(0,i.jsx)(c.B.hr,{ref:s,"aria-orientation":p,...b,__css:{...j,border:"0",borderColor:u,borderStyle:x,...{vertical:{borderLeftWidth:t||d||h||"1px",height:"100%"},horizontal:{borderBottomWidth:r||o||h||"1px",width:"100%"}}[p],...g},className:(0,n.cx)("chakra-divider",m)})});o.displayName="Divider"},72733:(e,s,t)=>{"use strict";t.d(s,{O:()=>a});var i=t(96918);let a={createToken:async e=>(await i.A.post("/webdav/token",e)).data.data,listTokens:async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=new URLSearchParams;return e&&t.append("bucket",e),s&&t.append("include_expired","true"),(await i.A.get("/webdav/token?".concat(t.toString()))).data.data},deleteToken:async e=>{await i.A.delete("/webdav/token/".concat(e))},getConnectionInfo:async e=>(await i.A.get("/webdav/token/connection-info/".concat(e))).data.data,testConnection:async e=>(await i.A.get("/webdav/token/test/".concat(e))).data.data,getAccessibleBuckets:async()=>(await i.A.get("/oss/region-buckets/user-accessible")).data.data}},91985:(e,s,t)=>{"use strict";t.d(s,{R:()=>i});let i=(0,t(24345).w)({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"})},96918:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});var i=t(23464),a=t(7161),n=t(87358);let r=i.A.create({baseURL:n.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{{let s=localStorage.getItem("token");s&&(e.headers.Authorization="Bearer ".concat(s))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),r.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let s=e.data;return s&&"object"==typeof s&&void 0!==s.code?0!==s.code&&200!==s.code?(console.error("API响应错误:",s),Promise.reject(Error(s.message||"请求失败"))):s:e},e=>{var s,t,i;return console.error("请求失败:",{url:null===(s=e.config)||void 0===s?void 0:s.url,message:e.message,response:null===(t=e.response)||void 0===t?void 0:t.data}),e.response?401===e.response.status?(0,a.Hl)():console.error("API错误:",(null===(i=e.response.data)||void 0===i?void 0:i.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let l=r}},e=>{var s=s=>e(e.s=s);e.O(0,[844,8791,6829,6980,7039,2210,3464,3513,8277,6654,8815,4415,8670,2714,8968,9963,9881,8441,1684,7358],()=>s(22531)),_N_E=e.O()}]);