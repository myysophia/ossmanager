(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7737],{7161:(e,s,t)=>{"use strict";t.d(s,{HY:()=>i,Hl:()=>o});let o=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},i=e=>{var s;return e&&"object"==typeof e&&"response"in e&&(null===(s=e.response)||void 0===s?void 0:s.status)===401}},83037:(e,s,t)=>{Promise.resolve().then(t.bind(t,89689))},89689:(e,s,t)=>{"use strict";t.d(s,{default:()=>P});var o=t(95155),i=t(12115),a=t(35695),r=t(7098),n=t(59108),l=t(58727),c=t(39376),d=t(77700),h=t(58670),p=t(1996),u=t(831),m=t(77978),x=t(47931),g=t(59771),j=t(43508),b=t(82610),f=t(82148),v=t(64688),y=t(19608),k=t(19782),C=t(27104),w=t(5643),I=t(75569),z=t(52017),S=t(10351);let N=e=>{let{toggleColorMode:s}=(0,r.G6)(),t=(0,r.dU)(S.hkc,S.Wh$),i=(0,r.dU)("深色模式","浅色模式");return(0,o.jsx)(m.$,{size:"sm",variant:"ghost","aria-label":"切换到".concat(i),leftIcon:(0,o.jsx)(t,{}),onClick:s,...e,children:e.children||i})};var A=t(96918),R=t(7161);let _=[{label:"首页",path:"/main/dashboard",icon:(0,o.jsx)(S.V5Y,{size:18})},{label:"文件上传",path:"/main/files/upload",icon:(0,o.jsx)(S.B88,{size:18})},{label:"文件查询",path:"/main/files",icon:(0,o.jsx)(S.CKj,{size:18})},{label:"后台管理",path:"/main/admin",icon:(0,o.jsx)(S.VSk,{size:18}),permissions:["admin"]},{label:"审计日志",path:"/main/admin/audit",icon:(0,o.jsx)(S.Wm,{size:18}),permissions:["admin"]}],L=i.memo(e=>{let{onMobileMenuOpen:s,user:t,onNavigate:i,onLogout:a}=e,f=(0,r.dU)("white","gray.800");return(0,o.jsxs)(n.s,{as:"header",position:"fixed",w:"full",h:"60px",px:4,bg:f,boxShadow:"sm",zIndex:10,alignItems:"center",justifyContent:"space-between",children:[(0,o.jsxs)(l.z,{spacing:4,children:[(0,o.jsx)(c.K,{"aria-label":"菜单",icon:(0,o.jsx)(S.ND1,{}),display:{base:"flex",md:"none"},onClick:s,variant:"ghost"}),(0,o.jsxs)(l.z,{spacing:2,cursor:"pointer",onClick:()=>i("/main/dashboard"),children:[(0,o.jsx)(d.a,{bg:"primary.500",p:1.5,borderRadius:"md",color:"white",children:(0,o.jsx)(S.Hbo,{size:16})}),(0,o.jsx)(h.E,{fontSize:"lg",fontWeight:"bold",children:"OSS 文件管理系统"})]})]}),t&&(0,o.jsxs)(l.z,{spacing:2,children:[(0,o.jsx)(N,{size:"sm"}),(0,o.jsxs)(p.W,{children:[(0,o.jsx)(u.I,{as:m.$,variant:"ghost",rounded:"full",children:(0,o.jsxs)(l.z,{children:[(0,o.jsx)(x.e,{size:"sm",name:t.name||t.username,bg:"primary.500"}),(0,o.jsx)(h.E,{display:{base:"none",md:"block"},children:t.name||t.username})]})}),(0,o.jsxs)(g.c,{children:[(0,o.jsx)(j.c,{}),(0,o.jsx)(b.D,{icon:(0,o.jsx)(S.QeK,{}),onClick:a,color:"red.500",children:"退出登录"})]})]})]})]})});L.displayName="TopNav",i.memo(e=>{let{item:s,isActive:t,isLoading:i,isCollapsed:a,onClick:r}=e;return(0,o.jsx)(m.$,{leftIcon:s.icon,variant:"ghost",justifyContent:a?"center":"flex-start",h:"40px",p:3*!a,color:t?"blue.500":void 0,fontWeight:t?"bold":"normal",isLoading:i&&t,onClick:r,title:a?s.label:void 0,children:!a&&s.label})}).displayName="MenuItemButton";let U=i.memo(e=>{let{isOpen:s,onClose:t,items:i,isActiveRoute:a,isLoading:r,onNavigate:n}=e;return(0,o.jsxs)(f._s,{isOpen:s,placement:"left",onClose:t,children:[(0,o.jsx)(v.m,{}),(0,o.jsxs)(y.z,{children:[(0,o.jsx)(k.s,{}),(0,o.jsx)(C.r,{borderBottomWidth:"1px",children:"菜单"}),(0,o.jsx)(w.c,{children:(0,o.jsx)(I.T,{spacing:2,align:"stretch",pt:2,children:i.map((e,s)=>(0,o.jsx)(m.$,{leftIcon:e.icon,variant:"ghost",justifyContent:"flex-start",isLoading:r&&a(e.path),color:a(e.path)?"blue.500":void 0,fontWeight:a(e.path)?"bold":"normal",onClick:()=>{n(e.path),t()},children:e.label},s))})})]})]})});U.displayName="MobileDrawer";let O=i.memo(e=>{let{isCollapsed:s,onToggle:t,items:i,isActiveRoute:a,isLoading:l,onNavigate:h}=e,p=(0,r.dU)("white","gray.800"),u=(0,r.dU)("gray.200","gray.700");return(0,o.jsx)(d.a,{position:"fixed",h:"calc(100vh - 60px)",w:s?"60px":"220px",mt:"60px",bg:p,borderRightWidth:"1px",borderColor:u,display:{base:"none",md:"block"},transition:"width 0.3s ease",zIndex:5,children:(0,o.jsxs)(n.s,{direction:"column",h:"full",children:[(0,o.jsx)(c.K,{"aria-label":s?"展开菜单":"收起菜单",icon:s?(0,o.jsx)(S.fOo,{}):(0,o.jsx)(S.irw,{}),size:"sm",position:"absolute",top:"4",right:"2",variant:"ghost",onClick:t}),(0,o.jsx)(I.T,{spacing:1,align:"stretch",p:3,pt:10,children:i.map((e,t)=>(0,o.jsx)(m.$,{leftIcon:e.icon,variant:"ghost",w:"100%",justifyContent:s?"center":"flex-start",h:"40px",px:s?2:4,borderRadius:"md",color:a(e.path)?"blue.500":void 0,fontWeight:a(e.path)?"bold":"normal",isActive:a(e.path),onClick:()=>h(e.path),_hover:{bg:"gray.100"},_active:{bg:"gray.200"},style:{zIndex:1},title:s?e.label:void 0,children:!s&&e.label},t))})]})})});O.displayName="DesktopSidebar";let P=e=>{let{children:s}=e,t=(0,a.useRouter)(),r=(0,a.usePathname)(),{isOpen:n,onOpen:l,onClose:c}=(0,z.j)(),[h,p]=(0,i.useState)(null),[u,m]=(0,i.useState)(!0),[x,g]=(0,i.useState)(!1),[j,b]=(0,i.useState)(!1),f=(0,i.useCallback)(e=>r===e,[r]),v=(0,i.useCallback)(e=>{if(e!==r){g(!0);try{t.push(e)}catch(e){console.error("[导航错误]:",e)}finally{setTimeout(()=>g(!1),200)}}},[t,r]),y=(0,i.useCallback)(()=>{(0,R.Hl)()},[]),k=(0,i.useCallback)(()=>{b(e=>!e)},[]);(0,i.useEffect)(()=>{!async function(){try{let e=(await A.A.get("/user/current")).data;if(e&&e.permissions){let s={...e,permissions:Array.isArray(e.permissions)?e.permissions:[]};p(s),localStorage.setItem("user",JSON.stringify(s))}else{let e=localStorage.getItem("user");if(e){let s=JSON.parse(e);p(s)}else"/auth/login"!==r&&"/auth/register"!==r&&t.push("/auth/login")}}catch(o){if(console.error("获取用户信息失败:",o),o&&"object"==typeof o&&"response"in o){var e;if((null===(e=o.response)||void 0===e?void 0:e.status)===401){(0,R.Hl)();return}}let s=localStorage.getItem("user");s?p(JSON.parse(s)):t.push("/auth/login")}finally{m(!1)}}()},[]);let C=_.filter(e=>!e.permissions||!e.permissions.includes("admin")||function(e){return!!e&&!!e.permissions&&e.permissions.some(e=>"MANAGER"===e.resource)}(h));return"/auth/login"===r||"/auth/register"===r?(0,o.jsx)(o.Fragment,{children:s}):u?(0,o.jsxs)(d.a,{minH:"100vh",display:"flex",children:[(0,o.jsx)(d.a,{w:{base:0,md:j?"60px":"220px"},bg:"gray.800",minH:"100vh",transition:"width 0.3s ease"}),(0,o.jsx)(d.a,{flex:1,bg:"white"})]}):(0,o.jsxs)(d.a,{minH:"100vh",children:[(0,o.jsx)(L,{onMobileMenuOpen:l,user:h,onNavigate:v,onLogout:y}),(0,o.jsx)(U,{isOpen:n,onClose:c,items:C,isActiveRoute:f,isLoading:x,onNavigate:v}),(0,o.jsx)(O,{isCollapsed:j,onToggle:k,items:C,isActiveRoute:f,isLoading:x,onNavigate:v}),(0,o.jsx)(d.a,{ml:{base:0,md:j?"60px":"220px"},pt:"60px",transition:"margin-left 0.3s ease",children:(0,o.jsx)(d.a,{p:4,children:s})})]})}},96918:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var o=t(23464),i=t(7161),a=t(49509);let r=o.A.create({baseURL:a.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{{let s=localStorage.getItem("token");s&&(e.headers.Authorization="Bearer ".concat(s))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),r.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let s=e.data;return s&&"object"==typeof s&&void 0!==s.code?0!==s.code&&200!==s.code?(console.error("API响应错误:",s),Promise.reject(Error(s.message||"请求失败"))):s:e},e=>{var s,t,o;return console.error("请求失败:",{url:null===(s=e.config)||void 0===s?void 0:s.url,message:e.message,response:null===(t=e.response)||void 0===t?void 0:t.data}),e.response?401===e.response.status?(0,i.Hl)():console.error("API错误:",(null===(o=e.response.data)||void 0===o?void 0:o.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let n=r}},e=>{var s=s=>e(e.s=s);e.O(0,[844,8791,6829,6980,3464,3513,6654,8815,8344,8441,1684,7358],()=>s(83037)),_N_E=e.O()}]);