(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7122],{24872:(e,s,i)=>{Promise.resolve().then(i.bind(i,53356))},35490:(e,s,i)=>{"use strict";i.d(s,{d:()=>h});var n=i(95155),a=i(78038),t=i(92622),l=i(12115),c=i(1106),r=i(30044),o=i(17891),d=i(47415);let h=(0,r.R)(function(e,s){let i=(0,o.o)("Switch",e),{spacing:r="0.5rem",children:h,...u}=(0,a.M)(e),{getIndicatorProps:x,getInputProps:p,getCheckboxProps:j,getRootProps:y,getLabelProps:g}=(0,c.v)(u),m=(0,l.useMemo)(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...i.container}),[i.container]),b=(0,l.useMemo)(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...i.track}),[i.track]),f=(0,l.useMemo)(()=>({userSelect:"none",marginStart:r,...i.label}),[r,i.label]);return(0,n.jsxs)(d.B.label,{...y(),className:(0,t.cx)("chakra-switch",e.className),__css:m,children:[(0,n.jsx)("input",{className:"chakra-switch__input",...p({},s)}),(0,n.jsx)(d.B.span,{...j(),className:"chakra-switch__track",__css:b,children:(0,n.jsx)(d.B.span,{__css:i.thumb,className:"chakra-switch__thumb",...x()})}),h&&(0,n.jsx)(d.B.span,{className:"chakra-switch__label",...g(),__css:f,children:h})]})});h.displayName="Switch"},53356:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>P});var n=i(95155),a=i(12115),t=i(23006),l=i(52017),c=i(7098),r=i(77700),o=i(6126),d=i(40988),h=i(96065),u=i(62833),x=i(93176),p=i(75569),j=i(58727),y=i(58670),g=i(77978),m=i(37824),b=i(83382),f=i(47272),_=i(76122),C=i(66080),k=i(24710),v=i(80436),S=i(1996),K=i(831),w=i(39376),T=i(59771),D=i(82610),M=i(26418),N=i(79175),E=i(33636),J=i(35490),z=i(25442),F=i(64688),R=i(61549),A=i(27104),q=i(5643),B=i(4316),U=i(49174),I=i(10351),O=i(14509);function P(){let[e,s]=(0,a.useState)([]),[i,P]=(0,a.useState)({siteName:"",description:"",maxFileSize:5120,allowedFileTypes:[],maxUploadConcurrency:5,enableRegistration:!1,enableCaptcha:!1,enablePublicAccess:!1,retentionDays:30}),[W,$]=(0,a.useState)(!1),[X,G]=(0,a.useState)(null),[Z,H]=(0,a.useState)({name:"",type:"",endpoint:"",accessKey:"",secretKey:"",bucket:"",region:"",isDefault:!1}),L=(0,t.d)(),{isOpen:Q,onOpen:V,onClose:Y}=(0,l.j)();(0,c.dU)("white","gray.800"),(0,c.dU)("gray.200","gray.600"),(0,a.useEffect)(()=>{ee(),es()},[]);let ee=async()=>{$(!0);try{let e=(await O.u.getStorageConfigs()).map(e=>({id:e.id,name:e.name,type:e.storage_type,endpoint:e.endpoint,accessKey:e.access_key,secretKey:e.secret_key,bucket:e.bucket,region:e.region,isDefault:e.is_default}));s(e)}catch(e){L({title:"获取存储配置失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:5e3,isClosable:!0})}finally{$(!1)}},es=async()=>{try{let e=await O.u.getSystemConfig(),s={siteName:e.site_name,description:e.description,maxFileSize:e.max_file_size,allowedFileTypes:e.allowed_file_types,maxUploadConcurrency:e.max_upload_concurrency,enableRegistration:e.enable_registration,enableCaptcha:e.enable_captcha,enablePublicAccess:e.enable_public_access,retentionDays:e.retention_days};P(s)}catch(e){L({title:"获取系统配置失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:5e3,isClosable:!0})}},ei=async()=>{try{await O.u.createStorageConfig({name:Z.name,storage_type:Z.type,access_key:Z.accessKey,secret_key:Z.secretKey,bucket:Z.bucket,region:Z.region,endpoint:Z.endpoint,is_default:Z.isDefault}),ee(),Y(),H({name:"",type:"",endpoint:"",accessKey:"",secretKey:"",bucket:"",region:"",isDefault:!1}),L({title:"创建存储配置成功",status:"success",duration:3e3,isClosable:!0})}catch(e){L({title:"创建存储配置失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:5e3,isClosable:!0})}},en=async()=>{if(X)try{await O.u.updateStorageConfig(X.id,{name:Z.name,storage_type:Z.type,access_key:Z.accessKey,secret_key:Z.secretKey,bucket:Z.bucket,region:Z.region,endpoint:Z.endpoint,is_default:Z.isDefault}),ee(),Y(),G(null),H({name:"",type:"",endpoint:"",accessKey:"",secretKey:"",bucket:"",region:"",isDefault:!1}),L({title:"更新存储配置成功",status:"success",duration:3e3,isClosable:!0})}catch(e){L({title:"更新存储配置失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:5e3,isClosable:!0})}},ea=async e=>{try{await O.u.deleteStorageConfig(e),ee(),L({title:"删除存储配置成功",status:"success",duration:3e3,isClosable:!0})}catch(e){L({title:"删除存储配置失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:5e3,isClosable:!0})}},et=async()=>{try{await O.u.updateSystemConfig({site_name:i.siteName,description:i.description,max_file_size:i.maxFileSize,allowed_file_types:i.allowedFileTypes,enable_registration:i.enableRegistration,enable_captcha:i.enableCaptcha}),L({title:"更新系统配置成功",status:"success",duration:3e3,isClosable:!0})}catch(e){L({title:"更新系统配置失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:5e3,isClosable:!0})}},el=e=>{G(e),H({name:e.name,type:e.type,endpoint:e.endpoint,accessKey:e.accessKey,secretKey:e.secretKey,bucket:e.bucket,region:e.region,isDefault:e.isDefault}),V()};return(0,n.jsxs)(r.a,{p:6,children:[(0,n.jsxs)(o.t,{children:[(0,n.jsxs)(d.w,{children:[(0,n.jsx)(h.o,{children:"存储配置"}),(0,n.jsx)(h.o,{children:"系统设置"})]}),(0,n.jsxs)(u.T,{children:[(0,n.jsx)(x.K,{children:(0,n.jsxs)(p.T,{spacing:6,align:"stretch",children:[(0,n.jsxs)(j.z,{justify:"space-between",children:[(0,n.jsx)(y.E,{fontSize:"2xl",fontWeight:"bold",children:"存储配置列表"}),(0,n.jsx)(g.$,{leftIcon:(0,n.jsx)(I.GGD,{}),onClick:()=>{G(null),H({name:"",type:"",endpoint:"",accessKey:"",secretKey:"",bucket:"",region:"",isDefault:!1}),V()},children:"新建配置"})]}),(0,n.jsx)(r.a,{overflowX:"auto",children:(0,n.jsxs)(m.X,{variant:"simple",children:[(0,n.jsx)(b.d,{children:(0,n.jsxs)(f.Tr,{children:[(0,n.jsx)(_.Th,{children:"名称"}),(0,n.jsx)(_.Th,{children:"类型"}),(0,n.jsx)(_.Th,{children:"端点"}),(0,n.jsx)(_.Th,{children:"存储桶"}),(0,n.jsx)(_.Th,{children:"区域"}),(0,n.jsx)(_.Th,{children:"默认"}),(0,n.jsx)(_.Th,{children:"操作"})]})}),(0,n.jsx)(C.N,{children:e.map(e=>(0,n.jsxs)(f.Tr,{children:[(0,n.jsx)(k.Td,{children:e.name}),(0,n.jsx)(k.Td,{children:e.type}),(0,n.jsx)(k.Td,{children:e.endpoint}),(0,n.jsx)(k.Td,{children:e.bucket}),(0,n.jsx)(k.Td,{children:e.region}),(0,n.jsx)(k.Td,{children:(0,n.jsx)(v.E,{colorScheme:e.isDefault?"green":"gray",children:e.isDefault?"是":"否"})}),(0,n.jsx)(k.Td,{children:(0,n.jsxs)(S.W,{children:[(0,n.jsx)(K.I,{as:w.K,icon:(0,n.jsx)(I.ZZB,{}),variant:"ghost",size:"sm"}),(0,n.jsxs)(T.c,{children:[(0,n.jsx)(D.D,{icon:(0,n.jsx)(I.WXf,{}),onClick:()=>el(e),children:"编辑"}),(0,n.jsx)(D.D,{icon:(0,n.jsx)(I.IXo,{}),onClick:()=>ea(e.id),color:"red.500",children:"删除"})]})]})})]},e.id))})]})})]})}),(0,n.jsx)(x.K,{children:(0,n.jsxs)(p.T,{spacing:6,align:"stretch",children:[(0,n.jsx)(y.E,{fontSize:"2xl",fontWeight:"bold",children:"系统设置"}),(0,n.jsxs)(p.T,{spacing:4,align:"stretch",children:[(0,n.jsxs)(M.MJ,{children:[(0,n.jsx)(N.l,{children:"最大文件大小 (MB)"}),(0,n.jsx)(E.p,{type:"number",value:i.maxFileSize,onChange:e=>P(s=>({...s,maxFileSize:Number(e.target.value)}))})]}),(0,n.jsxs)(M.MJ,{children:[(0,n.jsx)(N.l,{children:"允许的文件类型"}),(0,n.jsx)(E.p,{value:i.allowedFileTypes.join(", "),onChange:e=>P(s=>({...s,allowedFileTypes:e.target.value.split(",").map(e=>e.trim())})),placeholder:"用逗号分隔，例如：jpg, png, pdf"})]}),(0,n.jsxs)(M.MJ,{children:[(0,n.jsx)(N.l,{children:"最大上传并发数"}),(0,n.jsx)(E.p,{type:"number",value:i.maxUploadConcurrency,onChange:e=>P(s=>({...s,maxUploadConcurrency:Number(e.target.value)}))})]}),(0,n.jsxs)(M.MJ,{display:"flex",alignItems:"center",children:[(0,n.jsx)(N.l,{mb:"0",children:"启用公开访问"}),(0,n.jsx)(J.d,{isChecked:i.enablePublicAccess,onChange:e=>P(s=>({...s,enablePublicAccess:e.target.checked}))})]}),(0,n.jsxs)(M.MJ,{children:[(0,n.jsx)(N.l,{children:"文件保留天数"}),(0,n.jsx)(E.p,{type:"number",value:i.retentionDays,onChange:e=>P(s=>({...s,retentionDays:Number(e.target.value)}))})]}),(0,n.jsx)(g.$,{colorScheme:"blue",onClick:et,children:"保存设置"})]})]})})]})]}),(0,n.jsxs)(z.aF,{isOpen:Q,onClose:Y,children:[(0,n.jsx)(F.m,{}),(0,n.jsxs)(R.$,{children:[(0,n.jsx)(A.r,{children:X?"编辑存储配置":"新建存储配置"}),(0,n.jsx)(q.c,{children:(0,n.jsxs)(p.T,{spacing:4,children:[(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"配置名称"}),(0,n.jsx)(E.p,{value:Z.name,onChange:e=>H(s=>({...s,name:e.target.value})),placeholder:"请输入配置名称"})]}),(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"存储类型"}),(0,n.jsxs)(B.l,{value:Z.type,onChange:e=>H(s=>({...s,type:e.target.value})),children:[(0,n.jsx)("option",{value:"local",children:"本地存储"}),(0,n.jsx)("option",{value:"oss",children:"阿里云OSS"}),(0,n.jsx)("option",{value:"cos",children:"腾讯云COS"}),(0,n.jsx)("option",{value:"s3",children:"AWS S3"})]})]}),(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"端点"}),(0,n.jsx)(E.p,{value:Z.endpoint,onChange:e=>H(s=>({...s,endpoint:e.target.value})),placeholder:"请输入端点地址"})]}),(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"Access Key"}),(0,n.jsx)(E.p,{value:Z.accessKey,onChange:e=>H(s=>({...s,accessKey:e.target.value})),placeholder:"请输入Access Key"})]}),(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"Secret Key"}),(0,n.jsx)(E.p,{type:"password",value:Z.secretKey,onChange:e=>H(s=>({...s,secretKey:e.target.value})),placeholder:"请输入Secret Key"})]}),(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"存储桶"}),(0,n.jsx)(E.p,{value:Z.bucket,onChange:e=>H(s=>({...s,bucket:e.target.value})),placeholder:"请输入存储桶名称"})]}),(0,n.jsxs)(M.MJ,{isRequired:!0,children:[(0,n.jsx)(N.l,{children:"区域"}),(0,n.jsx)(E.p,{value:Z.region,onChange:e=>H(s=>({...s,region:e.target.value})),placeholder:"请输入区域"})]}),(0,n.jsxs)(M.MJ,{display:"flex",alignItems:"center",children:[(0,n.jsx)(N.l,{mb:"0",children:"设为默认"}),(0,n.jsx)(J.d,{isChecked:Z.isDefault,onChange:e=>H(s=>({...s,isDefault:e.target.checked}))})]})]})}),(0,n.jsxs)(U.j,{children:[(0,n.jsx)(g.$,{variant:"ghost",mr:3,onClick:Y,children:"取消"}),(0,n.jsx)(g.$,{colorScheme:"blue",onClick:X?en:ei,children:X?"更新":"创建"})]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[844,8791,6829,6980,7039,2210,3464,3513,8277,6654,8815,4415,4509,8441,1684,7358],()=>s(24872)),_N_E=e.O()}]);