(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{7161:(e,s,a)=>{"use strict";a.d(s,{HY:()=>t,Hl:()=>r});let r=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},t=e=>{var s;return e&&"object"==typeof e&&"response"in e&&(null===(s=e.response)||void 0===s?void 0:s.status)===401}},7283:(e,s,a)=>{"use strict";a.d(s,{IW:()=>l,NR:()=>i,QS:()=>t});var r=a(96918);let t={getUsers:async e=>{console.log("UserAPI.getUsers called with params:",e);let s=await r.A.get("/users",{params:e});return console.log("UserAPI.getUsers raw response:",s),s.data},getUser:async e=>(await r.A.get("/users/".concat(e))).data,createUser:async e=>(await r.A.post("/users",e)).data,updateUser:async(e,s)=>(await r.A.put("/users/".concat(e),s)).data,deleteUser:async e=>{await r.A.delete("/users/".concat(e))}},i={getRoles:async e=>{try{let i=(await r.A.get("/roles",{params:e})).data;if(i&&i.data&&Array.isArray(i.data.items)){let e=i.data.items.map(e=>{var s,a,r;return{id:e.id,name:null!==(s=e.name)&&void 0!==s?s:"",description:null!==(a=e.description)&&void 0!==a?a:"",permissions:Array.isArray(e.permissions)?e.permissions:[],created_at:null!==(r=e.created_at)&&void 0!==r?r:"",...e}});return{roles:e,total:e.length}}if(Array.isArray(i)){let e=i.map(e=>{var s,a,r;return{id:e.id,name:null!==(s=e.name)&&void 0!==s?s:"",description:null!==(a=e.description)&&void 0!==a?a:"",permissions:Array.isArray(e.permissions)?e.permissions:[],created_at:null!==(r=e.created_at)&&void 0!==r?r:"",...e}});return{roles:e,total:e.length}}if(i&&"object"==typeof i&&i.id){var s,a,t;return{roles:[{id:i.id,name:null!==(s=i.name)&&void 0!==s?s:"",description:null!==(a=i.description)&&void 0!==a?a:"",permissions:Array.isArray(i.permissions)?i.permissions:[],created_at:null!==(t=i.created_at)&&void 0!==t?t:"",...i}],total:1}}return{roles:[],total:0}}catch(e){return{roles:[],total:0}}},getRole:async e=>(await r.A.get("/roles/".concat(e))).data,createRole:async e=>(await r.A.post("/roles",e)).data,updateRole:async(e,s)=>(await r.A.put("/roles/".concat(e),s)).data,deleteRole:async e=>{await r.A.delete("/roles/".concat(e))},getRegionBucketMappings:async e=>(await r.A.get("/region-bucket-mappings",{params:e})).data,getRoleRegionBucketAccess:async e=>(await r.A.get("/roles/".concat(e,"/bucket-access"))).data,updateRoleRegionBucketAccess:async(e,s)=>{await r.A.put("/roles/".concat(e,"/bucket-access"),s)},deleteRoleRegionBucketAccess:async(e,s)=>{await r.A.delete("/roles/".concat(e,"/accessible-buckets/").concat(s))}},l={getPermissions:async e=>{try{let s=await r.A.get("/permissions",{params:e});if(console.log("PermissionAPI.getPermissions response:",s),console.log("PermissionAPI.getPermissions response.data:",s.data),s.data&&s.data.items)return console.log("PermissionAPI.getPermissions response.data.items:",s.data.items),{permissions:s.data.items,total:s.data.total};if(Array.isArray(s.data))return{permissions:s.data,total:s.data.length};return{permissions:[],total:0}}catch(e){throw console.error("PermissionAPI.getPermissions error:",e),e}},getPermission:async e=>(await r.A.get("/permissions/".concat(e))).data,createPermission:async e=>(await r.A.post("/permissions",e)).data,updatePermission:async(e,s)=>(await r.A.put("/permissions/".concat(e),s)).data,deletePermission:async e=>{await r.A.delete("/permissions/".concat(e))}}},29358:(e,s,a)=>{"use strict";a.d(s,{q:()=>t});var r=a(95155);let t=(0,a(24345).w)({displayName:"EditIcon",path:(0,r.jsxs)("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,r.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})},32643:(e,s,a)=>{"use strict";a.d(s,{d:()=>t});var r=a(95155);let t=(0,a(24345).w)({displayName:"DeleteIcon",path:(0,r.jsx)("g",{fill:"currentColor",children:(0,r.jsx)("path",{d:"M19.452 7.5H4.547a.5.5 0 00-.5.545l1.287 14.136A2 2 0 007.326 24h9.347a2 2 0 001.992-1.819L19.95 8.045a.5.5 0 00-.129-.382.5.5 0 00-.369-.163zm-9.2 13a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zm5 0a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zM22 4h-4.75a.25.25 0 01-.25-.25V2.5A2.5 2.5 0 0014.5 0h-5A2.5 2.5 0 007 2.5v1.25a.25.25 0 01-.25.25H2a1 1 0 000 2h20a1 1 0 000-2zM9 3.75V2.5a.5.5 0 01.5-.5h5a.5.5 0 01.5.5v1.25a.25.25 0 01-.25.25h-5.5A.25.25 0 019 3.75z"})})})},35077:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>q});var r=a(95155),t=a(12115),i=a(23006),l=a(52017),n=a(77700),o=a(58727),c=a(42066),d=a(49747),u=a(33636),m=a(77978),h=a(37824),p=a(83382),g=a(47272),x=a(76122),j=a(66080),v=a(24710),y=a(80436),_=a(35490),A=a(39376),w=a(84002),f=a(91985),b=a(29358),k=a(32643),S=a(7283),C=a(25442),N=a(64688),P=a(61549),I=a(27104),R=a(19782),M=a(5643),U=a(75569),T=a(26418),E=a(79175),B=a(52019),L=a(49174);function z(e){let{isOpen:s,onClose:a,user:l,onSuccess:n}=e,[o,c]=(0,t.useState)({username:"",password:"",email:"",real_name:"",role_ids:[]}),[d,h]=(0,t.useState)(!1),[p,g]=(0,t.useState)({}),x=(0,i.d)();(0,t.useEffect)(()=>{if(l){var e;c({email:l.email,real_name:l.real_name||"",status:l.status,role_ids:(null===(e=l.roles)||void 0===e?void 0:e.map(e=>Number(e.id)))||[]})}else c({username:"",password:"",email:"",real_name:"",role_ids:[]})},[l]);let j=()=>{let e={};return l||o.username||(e.username="用户名不能为空"),l||o.password||(e.password="密码不能为空"),o.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)||(e.email="邮箱格式不正确"):e.email="邮箱不能为空",g(e),0===Object.keys(e).length},v=async()=>{if(j())try{if(h(!0),l){let e={email:o.email,real_name:o.real_name,status:o.status,role_ids:o.role_ids};await S.QS.updateUser(l.id,e),x({title:"更新成功",status:"success",duration:3e3,isClosable:!0})}else{let e={username:o.username,password:o.password,email:o.email,real_name:o.real_name,role_ids:o.role_ids};await S.QS.createUser(e),x({title:"创建成功",status:"success",duration:3e3,isClosable:!0})}n(),a()}catch(e){x({title:l?"更新失败":"创建失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}finally{h(!1)}};return(0,r.jsxs)(C.aF,{isOpen:s,onClose:a,size:"md",children:[(0,r.jsx)(N.m,{}),(0,r.jsxs)(P.$,{children:[(0,r.jsx)(I.r,{children:l?"编辑用户":"新建用户"}),(0,r.jsx)(R.s,{}),(0,r.jsx)(M.c,{children:(0,r.jsxs)(U.T,{spacing:4,children:[!l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(T.MJ,{isInvalid:!!p.username,children:[(0,r.jsx)(E.l,{children:"用户名"}),(0,r.jsx)(u.p,{value:o.username,onChange:e=>c({...o,username:e.target.value})}),(0,r.jsx)(B.Wt,{children:p.username})]}),(0,r.jsxs)(T.MJ,{isInvalid:!!p.password,children:[(0,r.jsx)(E.l,{children:"密码"}),(0,r.jsx)(u.p,{type:"password",value:o.password,onChange:e=>c({...o,password:e.target.value})}),(0,r.jsx)(B.Wt,{children:p.password})]})]}),(0,r.jsxs)(T.MJ,{isInvalid:!!p.email,children:[(0,r.jsx)(E.l,{children:"邮箱"}),(0,r.jsx)(u.p,{value:o.email,onChange:e=>c({...o,email:e.target.value})}),(0,r.jsx)(B.Wt,{children:p.email})]}),(0,r.jsxs)(T.MJ,{children:[(0,r.jsx)(E.l,{children:"真实姓名"}),(0,r.jsx)(u.p,{value:o.real_name,onChange:e=>c({...o,real_name:e.target.value})})]}),l&&(0,r.jsxs)(T.MJ,{children:[(0,r.jsx)(E.l,{children:"状态"}),(0,r.jsx)(_.d,{isChecked:o.status,onChange:e=>c({...o,status:e.target.checked})}),(0,r.jsx)(T.eK,{children:"启用或禁用用户账号"})]})]})}),(0,r.jsxs)(L.j,{children:[(0,r.jsx)(m.$,{variant:"ghost",mr:3,onClick:a,children:"取消"}),(0,r.jsx)(m.$,{colorScheme:"blue",onClick:v,isLoading:d,children:l?"保存":"创建"})]})]})]})}function q(){let[e,s]=(0,t.useState)([]),[a,C]=(0,t.useState)(0),[N,P]=(0,t.useState)(1),[I]=(0,t.useState)(10),[R,M]=(0,t.useState)(""),[U,T]=(0,t.useState)(!1),E=(0,i.d)(),{isOpen:B,onOpen:L,onClose:q}=(0,l.j)(),[F,H]=(0,t.useState)(null),W=async()=>{try{T(!0);let e=await S.QS.getUsers({page:N,limit:I,search:R||void 0});s(e.users),C(e.total)}catch(e){E({title:"获取用户列表失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}finally{T(!1)}};(0,t.useEffect)(()=>{W()},[N,I,R]);let V=e=>{M(e),P(1)},J=e=>{H(e),L()},Q=async e=>{if(confirm("确定要删除该用户吗？"))try{await S.QS.deleteUser(e),E({title:"删除成功",status:"success",duration:3e3,isClosable:!0}),W()}catch(e){E({title:"删除失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}},Z=async(e,s)=>{try{await S.QS.updateUserStatus(e,s),E({title:"更新状态成功",status:"success",duration:3e3,isClosable:!0}),W()}catch(e){E({title:"更新状态失败",description:e instanceof Error?e.message:"未知错误",status:"error",duration:3e3,isClosable:!0})}};return(0,r.jsxs)(n.a,{p:4,children:[(0,r.jsxs)(o.z,{mb:4,justify:"space-between",children:[(0,r.jsxs)(c.M,{maxW:"300px",children:[(0,r.jsx)(d.W,{pointerEvents:"none",children:(0,r.jsx)(w.W,{color:"gray.300"})}),(0,r.jsx)(u.p,{placeholder:"搜索用户...",value:R,onChange:e=>V(e.target.value)})]}),(0,r.jsx)(m.$,{leftIcon:(0,r.jsx)(f.R,{}),colorScheme:"blue",onClick:()=>{H(null),L()},children:"新建用户"})]}),(0,r.jsxs)(h.X,{variant:"simple",children:[(0,r.jsx)(p.d,{children:(0,r.jsxs)(g.Tr,{children:[(0,r.jsx)(x.Th,{children:"用户名"}),(0,r.jsx)(x.Th,{children:"邮箱"}),(0,r.jsx)(x.Th,{children:"真实姓名"}),(0,r.jsx)(x.Th,{children:"角色"}),(0,r.jsx)(x.Th,{children:"状态"}),(0,r.jsx)(x.Th,{children:"创建时间"}),(0,r.jsx)(x.Th,{children:"操作"})]})}),(0,r.jsx)(j.N,{children:e.map(e=>{var s;return(0,r.jsxs)(g.Tr,{children:[(0,r.jsx)(v.Td,{children:e.username}),(0,r.jsx)(v.Td,{children:e.email}),(0,r.jsx)(v.Td,{children:e.real_name||"-"}),(0,r.jsx)(v.Td,{children:null===(s=e.roles)||void 0===s?void 0:s.map(e=>(0,r.jsx)(y.E,{mr:1,children:e.name},e.id))}),(0,r.jsx)(v.Td,{children:(0,r.jsx)(_.d,{isChecked:e.status,onChange:s=>Z(e.id,s.target.checked)})}),(0,r.jsx)(v.Td,{children:new Date(e.created_at).toLocaleString()}),(0,r.jsx)(v.Td,{children:(0,r.jsxs)(o.z,{spacing:2,children:[(0,r.jsx)(A.K,{"aria-label":"编辑用户",icon:(0,r.jsx)(b.q,{}),size:"sm",onClick:()=>J(e)}),(0,r.jsx)(A.K,{"aria-label":"删除用户",icon:(0,r.jsx)(k.d,{}),size:"sm",colorScheme:"red",onClick:()=>Q(e.id)})]})})]},e.id)})})]}),(0,r.jsx)(z,{isOpen:B,onClose:q,user:F,onSuccess:W})]})}},35490:(e,s,a)=>{"use strict";a.d(s,{d:()=>u});var r=a(95155),t=a(78038),i=a(92622),l=a(12115),n=a(1106),o=a(30044),c=a(17891),d=a(47415);let u=(0,o.R)(function(e,s){let a=(0,c.o)("Switch",e),{spacing:o="0.5rem",children:u,...m}=(0,t.M)(e),{getIndicatorProps:h,getInputProps:p,getCheckboxProps:g,getRootProps:x,getLabelProps:j}=(0,n.v)(m),v=(0,l.useMemo)(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),y=(0,l.useMemo)(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),_=(0,l.useMemo)(()=>({userSelect:"none",marginStart:o,...a.label}),[o,a.label]);return(0,r.jsxs)(d.B.label,{...x(),className:(0,i.cx)("chakra-switch",e.className),__css:v,children:[(0,r.jsx)("input",{className:"chakra-switch__input",...p({},s)}),(0,r.jsx)(d.B.span,{...g(),className:"chakra-switch__track",__css:y,children:(0,r.jsx)(d.B.span,{__css:a.thumb,className:"chakra-switch__thumb",...h()})}),u&&(0,r.jsx)(d.B.span,{className:"chakra-switch__label",...j(),__css:_,children:u})]})});u.displayName="Switch"},52019:(e,s,a)=>{"use strict";a.d(s,{Wt:()=>p});var r=a(95155),t=a(78038),i=a(61214),l=a(92622),n=a(26418),o=a(3740),c=a(30044),d=a(17891),u=a(47415);let[m,h]=(0,i.q)({name:"FormErrorStylesContext",errorMessage:"useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<FormError />\" "}),p=(0,c.R)((e,s)=>{let a=(0,d.o)("FormError",e),i=(0,t.M)(e),o=(0,n.Uc)();return(null==o?void 0:o.isInvalid)?(0,r.jsx)(m,{value:a,children:(0,r.jsx)(u.B.div,{...null==o?void 0:o.getErrorMessageProps(i,s),className:(0,l.cx)("chakra-form__error-message",e.className),__css:{display:"flex",alignItems:"center",...a.text}})}):null});p.displayName="FormErrorMessage",(0,c.R)((e,s)=>{let a=h(),t=(0,n.Uc)();if(!(null==t?void 0:t.isInvalid))return null;let i=(0,l.cx)("chakra-form__error-icon",e.className);return(0,r.jsx)(o.I,{ref:s,"aria-hidden":!0,...e,__css:a.icon,className:i,children:(0,r.jsx)("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}).displayName="FormErrorIcon"},56541:(e,s,a)=>{Promise.resolve().then(a.bind(a,35077))},79175:(e,s,a)=>{"use strict";a.d(s,{l:()=>d});var r=a(95155),t=a(78038),i=a(92622),l=a(26418),n=a(30044),o=a(17891),c=a(47415);let d=(0,n.R)(function(e,s){var a;let n=(0,o.V)("FormLabel",e),d=(0,t.M)(e),{className:m,children:h,requiredIndicator:p=(0,r.jsx)(u,{}),optionalIndicator:g=null,...x}=d,j=(0,l.Uc)(),v=null!==(a=null==j?void 0:j.getLabelProps(x,s))&&void 0!==a?a:{ref:s,...x};return(0,r.jsxs)(c.B.label,{...v,className:(0,i.cx)("chakra-form__label",d.className),__css:{display:"block",textAlign:"start",...n},children:[h,(null==j?void 0:j.isRequired)?p:g]})});d.displayName="FormLabel";let u=(0,n.R)(function(e,s){let a=(0,l.Uc)(),t=(0,l.TP)();if(!(null==a?void 0:a.isRequired))return null;let n=(0,i.cx)("chakra-form__required-indicator",e.className);return(0,r.jsx)(c.B.span,{...null==a?void 0:a.getRequiredIndicatorProps(e,s),__css:t.requiredIndicator,className:n})});u.displayName="RequiredIndicator"},80436:(e,s,a)=>{"use strict";a.d(s,{E:()=>c});var r=a(95155),t=a(78038),i=a(92622),l=a(30044),n=a(17891),o=a(47415);let c=(0,l.R)(function(e,s){let a=(0,n.V)("Badge",e),{className:l,...c}=(0,t.M)(e);return(0,r.jsx)(o.B.span,{ref:s,className:(0,i.cx)("chakra-badge",e.className),...c,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});c.displayName="Badge"},84002:(e,s,a)=>{"use strict";a.d(s,{W:()=>r});let r=(0,a(24345).w)({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"})},91985:(e,s,a)=>{"use strict";a.d(s,{R:()=>r});let r=(0,a(24345).w)({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"})},96918:(e,s,a)=>{"use strict";a.d(s,{A:()=>n});var r=a(23464),t=a(7161),i=a(49509);let l=r.A.create({baseURL:i.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let s=localStorage.getItem("token");s&&(e.headers.Authorization="Bearer ".concat(s))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),l.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let s=e.data;return s&&"object"==typeof s&&void 0!==s.code?0!==s.code&&200!==s.code?(console.error("API响应错误:",s),Promise.reject(Error(s.message||"请求失败"))):s:e},e=>{var s,a,r;return console.error("请求失败:",{url:null===(s=e.config)||void 0===s?void 0:s.url,message:e.message,response:null===(a=e.response)||void 0===a?void 0:a.data}),e.response?401===e.response.status?(0,t.Hl)():console.error("API错误:",(null===(r=e.response.data)||void 0===r?void 0:r.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let n=l}},e=>{var s=s=>e(e.s=s);e.O(0,[8791,6829,6980,7039,2210,3464,3513,8277,5030,8441,1684,7358],()=>s(56541)),_N_E=e.O()}]);