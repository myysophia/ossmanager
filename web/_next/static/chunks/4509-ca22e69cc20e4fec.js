"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4509],{7161:(e,t,a)=>{a.d(t,{HY:()=>s,Hl:()=>o});let o=()=>{console.log("\uD83D\uDD10 认证令牌过期，清除认证信息并重定向到登录页..."),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")},s=e=>{var t;return e&&"object"==typeof e&&"response"in e&&(null===(t=e.response)||void 0===t?void 0:t.status)===401}},14509:(e,t,a)=>{a.d(t,{u:()=>u,pq:()=>o.p,bH:()=>n,zh:()=>s.z});var o=a(22370),s=a(72515),r=a(96918);let n={getConfigs:async e=>(await r.A.get("/oss/configs",{params:e})).data.data,getConfigById:async e=>(await r.A.get("/oss/configs/".concat(e))).data.data,createConfig:async e=>(await r.A.post("/oss/configs",e)).data.data,updateConfig:async(e,t)=>(await r.A.put("/oss/configs/".concat(e),t)).data.data,deleteConfig:async e=>(await r.A.delete("/oss/configs/".concat(e))).data.data,setDefaultConfig:async e=>(await r.A.put("/oss/configs/".concat(e,"/default"))).data.data,testConnection:async e=>{try{return await r.A.post("/oss/configs/".concat(e,"/test")),!0}catch(e){return!1}}};var c=a(23464),i=a(7161),l=a(49509);let d=c.A.create({baseURL:l.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:1e4,headers:{"Content-Type":"application/json"}});d.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),d.interceptors.response.use(e=>e.data,e=>e.response?(401===e.response.status&&(0,i.Hl)(),Promise.reject(e.response.data)):Promise.reject(e));let u={getUsers:async()=>(await r.A.get("/admin/users")).data,createUser:async e=>(await r.A.post("/admin/users",e)).data,updateUser:async(e,t)=>(await r.A.put("/admin/users/".concat(e),t)).data,deleteUser:async e=>{await r.A.delete("/admin/users/".concat(e))},getRoles:async()=>(await r.A.get("/admin/roles")).data,createRole:async e=>(await r.A.post("/admin/roles",e)).data,updateRole:async(e,t)=>(await r.A.put("/admin/roles/".concat(e),t)).data,deleteRole:async e=>{await r.A.delete("/admin/roles/".concat(e))},getPermissions:async()=>(await r.A.get("/admin/permissions")).data,getStorageConfigs:async()=>(await r.A.get("/admin/storage-configs")).data,createStorageConfig:async e=>(await r.A.post("/admin/storage-configs",e)).data,updateStorageConfig:async(e,t)=>(await r.A.put("/admin/storage-configs/".concat(e),t)).data,deleteStorageConfig:async e=>{await r.A.delete("/admin/storage-configs/".concat(e))},getSystemConfig:async()=>(await r.A.get("/admin/system-config")).data,updateSystemConfig:async e=>(await r.A.put("/admin/system-config",e)).data,getAuditLogs:async e=>{let t=new URLSearchParams(e);return(await r.A.get("/admin/audit-logs?".concat(t))).data}}},22370:(e,t,a)=>{a.d(t,{p:()=>r});var o=a(96918),s=a(7161);let r={login:async e=>{try{let t=await o.A.post("/auth/login",e);if(console.log("登录响应数据:",t),!t.data||"object"!=typeof t.data)throw console.error("响应数据格式错误:",t),Error("响应数据格式错误");let a=t.data,s=a.data||a;if(!s.token||!s.user)throw console.error("缺少token或user数据:",a),Error("认证响应缺少必要数据");let{token:r,user:n}=s;return localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(n)),document.cookie="token=".concat(r,"; path=/; ").concat("secure;"," samesite=strict; max-age=86400"),s}catch(e){if(console.error("登录失败:",e),e.message)throw e;throw Error("登录失败，请检查用户名和密码")}},register:async e=>{await o.A.post("/auth/register",e)},getCurrentUser:async()=>(await o.A.get("/user/current")).data.data,logout:async()=>{try{await o.A.post("/auth/logout")}catch(e){console.warn("服务器登出请求失败，但仍会清除本地认证信息:",e)}(0,s.Hl)()},isAuthenticated:()=>!!localStorage.getItem("token"),getStoredUser:()=>{let e=localStorage.getItem("user");if(e)try{return JSON.parse(e)}catch(e){console.error("解析用户信息失败",e)}return null}}},72515:(e,t,a)=>{a.d(t,{z:()=>s});var o=a(96918);let s={getFiles:async e=>(await o.A.get("/oss/files",{params:e})).data,uploadFile:async(e,t)=>{let a=e instanceof FormData?e:(()=>{let t=new FormData;return t.append("file",e),t})(),s={"Content-Type":"multipart/form-data"};return(null==t?void 0:t.regionCode)&&(s.region_code=t.regionCode),(null==t?void 0:t.bucketName)&&(s.bucket_name=t.bucketName),(await o.A.post("/oss/files",a,{headers:s})).data.data},initMultipartUpload:async(e,t)=>(await o.A.post("/oss/multipart/init",null,{params:{filename:e,storage_type:t}})).data,completeMultipartUpload:async e=>(await o.A.post("/oss/multipart/complete",e)).data,abortMultipartUpload:async(e,t,a)=>{await o.A.delete("/oss/multipart/abort",{params:{upload_id:e,filename:t,storage_type:a}})},getFileDownloadURL:async(e,t)=>{let a={};return void 0!==t&&(a.expire_hours=t),(await o.A.get("/oss/files/".concat(e,"/download"),{params:a})).data},triggerMD5Calculation:async e=>{await o.A.post("/oss/files/".concat(e,"/md5"))},getFileMD5:async e=>(await o.A.get("/oss/files/".concat(e,"/md5"))).data,deleteFile:async e=>{await o.A.delete("/oss/files/".concat(e))}}},96918:(e,t,a)=>{a.d(t,{A:()=>c});var o=a(23464),s=a(7161),r=a(49509);let n=o.A.create({baseURL:r.env.NEXT_PUBLIC_API_URL||"http://localhost:8081/api/v1",timeout:36e5,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return console.log("发送请求:",{url:e.url,method:e.method,baseURL:e.baseURL,headers:e.headers,fullPath:"".concat(e.baseURL).concat(e.url)}),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),n.interceptors.response.use(e=>{console.log("收到响应:",{url:e.config.url,status:e.status,data:e.data});let t=e.data;return t&&"object"==typeof t&&void 0!==t.code?0!==t.code&&200!==t.code?(console.error("API响应错误:",t),Promise.reject(Error(t.message||"请求失败"))):t:e},e=>{var t,a,o;return console.error("请求失败:",{url:null===(t=e.config)||void 0===t?void 0:t.url,message:e.message,response:null===(a=e.response)||void 0===a?void 0:a.data}),e.response?401===e.response.status?(0,s.Hl)():console.error("API错误:",(null===(o=e.response.data)||void 0===o?void 0:o.message)||"请求失败"):e.request?console.error("网络错误: 请检查网络连接"):console.error("请求错误:",e.message||"发生未知错误"),Promise.reject(e)});let c=n}}]);